<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Skill-Twin Engine | AI Gap Analyzer</title>

    <!-- Google Font: Outfit -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ["Outfit", "system-ui", "sans-serif"],
            },
            colors: {
              slateDeep: "#0f172a",
              glass: "rgba(30, 41, 59, 0.7)",
              emeraldSoft: "#22c55e",
              amberSoft: "#fbbf24",
              roseSoft: "#fb7185",
              cyanSoft: "#22d3ee",
              neonPurple: "#a855f7",
            },
          },
        },
      };
    </script>

    <!-- Font Awesome 6 -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <!-- Chart.js 3.9 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>

    <!-- Chart.js Venn Plugin -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-venn@3.6.0/build/index.umd.min.js"></script>

    <!-- Vanilla Tilt (3D Card Effect) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vanilla-tilt/1.8.1/vanilla-tilt.min.js"></script>

    <!-- Marked.js -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <script>
      if (typeof pdfjsLib !== 'undefined') {
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';
      }
    </script>

    <style>
      :root {
        color-scheme: dark;
      }

      body {
        background: radial-gradient(circle at top left, #0f172a 0, #020617 45%, #000 100%);
        min-height: 100vh;
      }

      /* Better spacing for ERP feel */
      #app-shell {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      main {
        flex: 1;
        display: flex;
        flex-direction: column;
      }

      .glass-card {
        background: rgba(30, 41, 59, 0.7);
        border: 1px solid rgba(255, 255, 255, 0.08);
        box-shadow: 0 18px 45px rgba(15, 23, 42, 0.9);
        backdrop-filter: blur(14px);
        position: relative;
        overflow: hidden;
        transform-style: preserve-3d;
      }

      .glass-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
        transition: left 0.5s;
      }

      .glass-card:hover::before {
        left: 100%;
      }

      .bg-blob {
        position: fixed;
        border-radius: 9999px;
        filter: blur(60px);
        opacity: 0.35;
        z-index: -1;
      }

      .bg-blob-purple {
        background: radial-gradient(circle, rgba(168, 85, 247, 0.9), transparent 60%);
      }

      .bg-blob-indigo {
        background: radial-gradient(circle, rgba(79, 70, 229, 0.9), transparent 60%);
      }

      @keyframes float {
        0%, 100% {
          transform: translateY(0px) rotate(0deg);
        }
        25% {
          transform: translateY(-15px) rotate(2deg);
        }
        50% {
          transform: translateY(-20px) rotate(0deg);
        }
        75% {
          transform: translateY(-10px) rotate(-2deg);
        }
      }

      @keyframes fade-in {
        0% {
          opacity: 0;
          transform: translateY(20px) scale(0.95);
        }
        100% {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      @keyframes slide-in-right {
        0% {
          opacity: 0;
          transform: translateX(30px);
        }
        100% {
          opacity: 1;
          transform: translateX(0);
        }
      }

      @keyframes slide-in-left {
        0% {
          opacity: 0;
          transform: translateX(-30px);
        }
        100% {
          opacity: 1;
          transform: translateX(0);
        }
      }

      @keyframes scale-in {
        0% {
          opacity: 0;
          transform: scale(0.8);
        }
        100% {
          opacity: 1;
          transform: scale(1);
        }
      }

      @keyframes pulse-glow {
        0%, 100% {
          box-shadow: 0 0 20px rgba(34, 197, 94, 0.3);
        }
        50% {
          box-shadow: 0 0 30px rgba(34, 197, 94, 0.6);
        }
      }

      @keyframes shimmer {
        0% {
          background-position: -1000px 0;
        }
        100% {
          background-position: 1000px 0;
        }
      }

      @keyframes spin-soft {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }

      @keyframes bounce-subtle {
        0%, 100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-5px);
        }
      }

      .animate-float {
        animation: float 8s ease-in-out infinite;
      }

      .animate-fade-in {
        animation: fade-in 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
      }

      .animate-slide-in-right {
        animation: slide-in-right 0.5s ease-out forwards;
      }

      .animate-slide-in-left {
        animation: slide-in-left 0.5s ease-out forwards;
      }

      .animate-scale-in {
        animation: scale-in 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
      }

      .animate-spin-soft {
        animation: spin-soft 1.2s linear infinite;
      }

      .animate-bounce-subtle {
        animation: bounce-subtle 2s ease-in-out infinite;
      }

      .animate-pulse-fast {
        animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
      }

      /* Enhanced hover effects */
      .glass-card {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .glass-card:hover {
        box-shadow: 0 25px 50px rgba(15, 23, 42, 1);
      }

      /* Stagger animation for cards */
      [data-view] > * {
        animation-delay: calc(var(--stagger-delay, 0) * 0.1s);
      }

      /* Smooth transitions */
      * {
        transition-property: color, background-color, border-color, transform, box-shadow, opacity;
        transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        transition-duration: 200ms;
      }

      /* Loading shimmer effect */
      @keyframes shimmer {
        0% {
          background-position: -1000px 0;
        }
        100% {
          background-position: 1000px 0;
        }
      }

      .shimmer {
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
        background-size: 1000px 100%;
        animation: shimmer 2s infinite;
      }

      /* Enhanced card hover effects */
      [data-nav-card] {
        position: relative;
        overflow: hidden;
      }

      [data-nav-card]::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        transform: translate(-50%, -50%);
        transition: width 0.6s, height 0.6s;
      }

      [data-nav-card]:hover::after {
        width: 300px;
        height: 300px;
      }

      button {
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      }

      button:hover {
        transform: translateY(-2px);
      }

      button:active {
        transform: translateY(0);
      }

      /* Timeline Styles */
      .timeline-line {
        position: absolute;
        left: 15px;
        top: 0;
        bottom: 0;
        width: 2px;
        background: rgba(148, 163, 184, 0.2);
      }

      .scrollbar-thin::-webkit-scrollbar {
        width: 6px;
        height: 6px;
      }

      .scrollbar-thin::-webkit-scrollbar-thumb {
        background-color: rgba(148, 163, 184, 0.7);
        border-radius: 9999px;
      }

      .scrollbar-thin::-webkit-scrollbar-track {
        background-color: transparent;
      }

      /* Light Mode Styles - Cool & Modern */
      body.light-mode {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #4facfe 75%, #00f2fe 100%);
        background-size: 400% 400%;
        animation: gradientShift 15s ease infinite;
        color: #1e293b;
      }

      @keyframes gradientShift {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }

      body.light-mode .bg-blob-purple {
        background: radial-gradient(circle, rgba(102, 126, 234, 0.4), transparent 60%);
      }

      body.light-mode .bg-blob-indigo {
        background: radial-gradient(circle, rgba(118, 75, 162, 0.4), transparent 60%);
      }

      body.light-mode .glass-card {
        background: rgba(255, 255, 255, 0.95);
        border: 1px solid rgba(255, 255, 255, 0.5);
        box-shadow: 0 20px 60px rgba(102, 126, 234, 0.2), 0 0 0 1px rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(20px) saturate(180%);
        color: #1e293b;
      }

      body.light-mode .glass-card:hover {
        box-shadow: 0 25px 70px rgba(102, 126, 234, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.2);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      body.light-mode .text-slate-100,
      body.light-mode .text-slate-50 {
        color: #0f172a !important;
      }

      body.light-mode .text-slate-300 {
        color: #475569 !important;
      }

      body.light-mode .text-slate-400 {
        color: #64748b !important;
      }

      body.light-mode .bg-slate-900,
      body.light-mode .bg-slate-800 {
        background-color: rgba(248, 250, 252, 0.9) !important;
      }

      body.light-mode .border-slate-800,
      body.light-mode .border-slate-700 {
        border-color: rgba(148, 163, 184, 0.3) !important;
      }

      body.light-mode .bg-slate-800\/80 {
        background-color: rgba(248, 250, 252, 0.8) !important;
      }

      body.light-mode input,
      body.light-mode select,
      body.light-mode textarea {
        background-color: rgba(255, 255, 255, 0.9) !important;
        border-color: rgba(148, 163, 184, 0.4) !important;
        color: #0f172a !important;
      }

      body.light-mode input:focus,
      body.light-mode select:focus,
      body.light-mode textarea:focus {
        border-color: #667eea !important;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1) !important;
      }

      body.light-mode .text-emerald-300,
      body.light-mode .text-emerald-400 {
        color: #10b981 !important;
      }

      body.light-mode .text-sky-300,
      body.light-mode .text-sky-400 {
        color: #3b82f6 !important;
      }

      body.light-mode .text-amber-300,
      body.light-mode .text-amber-400 {
        color: #f59e0b !important;
      }

      body.light-mode .text-violet-300,
      body.light-mode .text-violet-400 {
        color: #8b5cf6 !important;
      }

      body.light-mode .text-rose-300,
      body.light-mode .text-rose-400 {
        color: #f43f5e !important;
      }

      /* Enhanced button styles for light mode */
      body.light-mode button {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      body.light-mode button:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
      }

      /* Glitch Text Effect for Title */
      .glitch-text:hover {
        text-shadow: 2px 0 #ff00c1, -2px 0 #01ffff;
      }

      /* Circular Progress Animation */
      @property --progress {
        syntax: '<number>';
        inherits: false;
        initial-value: 0;
      }
    </style>
  </head>

  <body class="font-sans text-slate-100">
    <!-- Background Blobs -->
    <div class="bg-blob bg-blob-purple w-80 h-80 top-[-40px] left-[-40px]"></div>
    <div class="bg-blob bg-blob-indigo w-96 h-96 bottom-[-60px] right-[-40px]"></div>

    <!-- Toast -->
    <div
      id="toast"
      class="fixed top-5 right-5 z-40 hidden px-4 py-3 rounded-xl glass-card text-sm flex items-center gap-3"
    >
      <span id="toast-icon" class="text-rose-400">
        <i class="fa-solid fa-triangle-exclamation"></i>
      </span>
      <span id="toast-message" class="text-slate-100"></span>
    </div>

    <!-- App Shell -->
    <div id="app-shell" class="hidden min-h-screen flex flex-col">
      <div class="flex min-h-screen">
        <!-- Sidebar -->
        <aside
          id="sidebar"
          class="glass-card w-72 shrink-0 border-r border-slate-800/60 flex flex-col p-5 gap-6 relative"
        >
          <div class="flex items-center justify-between mb-2">
            <div class="flex items-center gap-3">
              <div
                class="h-10 w-10 rounded-2xl bg-gradient-to-tr from-cyan-500 via-blue-500 to-purple-500 flex items-center justify-center animate-float"
              >
                <i class="fa-solid fa-dna text-lg text-white"></i>
              </div>
              <div>
                <div class="text-[10px] uppercase tracking-[0.2em] text-cyan-400 font-bold">
                  AI-Powered
                </div>
                <div class="font-bold text-slate-50 glitch-text">
                  Skill-Twin Engine
                </div>
              </div>
            </div>
            <button
              id="sidebar-toggle"
              class="md:hidden inline-flex items-center justify-center h-9 w-9 rounded-xl bg-slate-800/80 hover:bg-cyan-500/20 transition"
            >
              <i class="fa-solid fa-bars text-slate-200"></i>
            </button>
          </div>

          <div class="mt-2 mb-3 text-xs text-slate-400 space-y-1 border-b border-slate-800/50 pb-3">
            <div id="sidebar-role" class="font-medium text-slate-100"></div>
            <div id="sidebar-user" class="truncate"></div>
          </div>

          <nav class="mt-2 flex-1 overflow-y-auto scrollbar-thin">
            <ul class="space-y-1 text-sm" id="nav-links">
              <!-- Links injected by JS based on role -->
            </ul>
          </nav>

          <!-- Market Ticker -->
          <div id="market-pulse-btn" class="mt-auto p-3 rounded-xl bg-slate-900/40 border border-slate-800/60 text-xs cursor-pointer hover:border-cyan-500/50 hover:bg-slate-900/60 transition group">
            <p class="text-cyan-400 mb-2 uppercase tracking-wider font-bold flex items-center gap-2">
              <i class="fa-solid fa-arrow-trend-up"></i> Market Pulse
            </p>
            <div id="market-ticker" class="space-y-2 text-slate-400 h-16 overflow-hidden relative"></div>
          </div>

          <div class="pt-4 border-t border-slate-800 mt-4 space-y-2">
            <div class="flex items-center justify-between gap-2">
              <button
                id="theme-toggle"
                class="flex items-center gap-2 text-xs text-slate-300 hover:text-emerald-300 transition px-2 py-1 rounded-lg hover:bg-slate-800/60"
                title="Toggle Dark/Light Mode (T)"
              >
                <i class="fa-solid fa-moon"></i>
                <span class="hidden md:inline">Theme</span>
              </button>
              <button
                id="ai-chat-toggle"
                class="flex items-center gap-2 text-xs text-slate-300 hover:text-violet-300 transition px-2 py-1 rounded-lg hover:bg-slate-800/60"
                title="AI Assistant (A)"
              >
                <i class="fa-solid fa-robot"></i>
                <span class="hidden md:inline">AI Chat</span>
              </button>
            </div>
            <div class="flex items-center justify-between gap-3">
              <button
                id="view-notifications-btn"
                class="flex items-center gap-2 text-xs text-slate-300 hover:text-emerald-300 transition relative"
              >
                <i class="fa-solid fa-bell"></i>
                <span>Notifications</span>
                <span id="notification-badge" class="hidden absolute -top-1 -right-1 h-4 w-4 rounded-full bg-rose-500 text-[8px] flex items-center justify-center text-white font-bold">0</span>
              </button>
              <button
                id="logout-btn"
                class="flex items-center gap-2 text-xs px-3 py-1.5 rounded-lg bg-slate-800/80 hover:bg-rose-600/80 text-slate-100 transition"
              >
                <i class="fa-solid fa-arrow-right-from-bracket"></i>
                <span>Logout</span>
              </button>
            </div>
          </div>
        </aside>

        <!-- Content Area -->
        <div class="flex-1 flex flex-col min-w-0">
          <!-- Top Bar -->
          <div class="glass-card border-b border-slate-800/60 px-6 py-4 flex items-center justify-between shrink-0">
            <div id="breadcrumbs" class="flex items-center gap-2 text-sm">
              <span class="text-slate-400">Engine</span>
              <i class="fa-solid fa-chevron-right text-[10px] text-slate-600"></i>
              <span class="text-slate-200 font-medium" id="breadcrumb-current">Dashboard</span>
            </div>
            <div class="flex items-center gap-3">
              <button
                id="btn-global-analyze"
                class="inline-flex items-center gap-2 px-3 py-1.5 rounded-lg bg-gradient-to-r from-cyan-500 to-blue-500 text-white text-xs font-semibold shadow-lg shadow-cyan-500/30 hover:shadow-cyan-400/50 transition animate-pulse-glow"
              >
                <i class="fa-solid fa-microchip"></i>
                <span class="hidden md:inline">Run Twin Engine</span>
              </button>
              <button
                id="btn-export-report"
                class="inline-flex items-center gap-2 px-3 py-1.5 rounded-lg bg-slate-800/80 hover:bg-slate-700 text-xs text-slate-200 transition"
                title="Export Profile (E)"
              >
                <i class="fa-solid fa-file-export"></i>
              </button>
            </div>
          </div>

          <!-- Main Content -->
          <main class="flex-1 overflow-y-auto scrollbar-thin">
            <div class="max-w-7xl mx-auto p-6 lg:p-8 pb-32">
            
            <!-- Dashboard View -->
            <section
              data-view="dashboard"
              class="hidden grid grid-cols-1 gap-6 animate-fade-in"
            >
              <div class="mb-2">
                <h1 class="text-3xl font-bold text-slate-50 mb-2">Employability Command Center</h1>
                <div class="flex items-center justify-between">
                  <p class="text-slate-400">Welcome, <span id="user-welcome-name" class="text-cyan-300 font-medium"></span>. Your digital twin is active.</p>
                  <div class="flex gap-2">
                    <span class="px-2 py-1 rounded bg-emerald-500/10 text-emerald-400 text-xs border border-emerald-500/20">
                      <i class="fa-solid fa-link"></i> Live Market Data
                    </span>
                  </div>
                </div>
              </div>

              <!-- FOMO Engine Alert -->
              <div id="fomo-alert" class="glass-card rounded-xl p-4 border border-amber-500/40 bg-gradient-to-r from-amber-500/10 to-transparent relative overflow-hidden hidden cursor-pointer hover:border-amber-400/60 transition group">
                <div class="absolute -right-6 -top-6 h-24 w-24 bg-amber-500/20 rounded-full blur-xl animate-pulse"></div>
                <div class="flex items-start gap-4 relative z-10">
                    <div class="h-10 w-10 rounded-lg bg-amber-500/20 text-amber-300 flex items-center justify-center shrink-0 group-hover:scale-110 transition">
                        <i class="fa-solid fa-fire-flame-curved text-lg"></i>
                    </div>
                    <div>
                        <h3 class="text-sm font-bold text-slate-100 flex items-center gap-2">
                            Skill Scarcity Alert <span class="text-[10px] font-normal text-slate-400">(50-mile radius)</span>
                        </h3>
                        <p id="fomo-message" class="text-xs text-slate-300 mt-1 leading-relaxed"></p>
                    </div>
                </div>
              </div>

              <!-- Quick Stats Cards -->
              <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- Readiness Score -->
                <div class="glass-card rounded-xl p-5 border border-cyan-500/20 hover:border-cyan-500/40 transition-all duration-300 group animate-scale-in" style="--stagger-delay: 0">
                  <div class="flex items-center justify-between mb-3">
                    <div class="h-12 w-12 rounded-xl bg-cyan-500/10 text-cyan-300 flex items-center justify-center group-hover:scale-110 transition-all">
                      <i class="fa-solid fa-gauge-high text-lg"></i>
                    </div>
                    <span class="text-xs font-mono text-cyan-400 bg-cyan-900/30 px-2 py-1 rounded">+5% this week</span>
                  </div>
                  <div class="flex items-center justify-center py-2">
                    <div id="dash-readiness-circle" class="relative h-28 w-28 rounded-full flex items-center justify-center transition-all duration-1000" 
                         style="background: conic-gradient(#22d3ee calc(var(--progress) * 1%), rgba(30, 41, 59, 0.5) 0);">
                       <div class="absolute inset-2 bg-slate-900 rounded-full flex flex-col items-center justify-center shadow-inner">
                          <span id="dash-readiness-score" class="text-2xl font-bold text-slate-50">0%</span>
                          <span class="text-[9px] text-slate-400 uppercase tracking-wider">Readiness</span>
                       </div>
                    </div>
                  </div>
                </div>

                <!-- Skill Gaps -->
                <div class="glass-card rounded-xl p-5 border border-rose-500/20 hover:border-rose-500/40 transition-all duration-300 group animate-scale-in" style="--stagger-delay: 1">
                  <div class="flex items-center justify-between mb-3">
                    <div class="h-12 w-12 rounded-xl bg-rose-500/10 text-rose-300 flex items-center justify-center group-hover:scale-110 transition-all">
                      <i class="fa-solid fa-puzzle-piece text-lg"></i>
                    </div>
                  </div>
                  <p class="text-xs text-slate-400 mb-1">Critical Skill Gaps</p>
                  <div class="flex items-baseline gap-2 mb-2">
                    <p id="dash-gap-count" class="text-3xl font-bold text-slate-50">0</p>
                    <p class="text-[10px] text-slate-500">High Priority</p>
                  </div>
                  <p class="text-[10px] text-rose-400 mt-1">Needs immediate attention</p>
                </div>

                <!-- Market Alignment -->
                <div id="market-align-card" class="glass-card rounded-xl p-5 border border-emerald-500/20 hover:border-emerald-500/40 transition-all duration-300 group animate-scale-in" style="--stagger-delay: 2">
                  <div class="flex items-center justify-between mb-3">
                    <div id="market-align-icon" class="h-12 w-12 rounded-xl bg-emerald-500/10 text-emerald-300 flex items-center justify-center group-hover:scale-110 transition-all">
                      <i class="fa-solid fa-handshake text-lg"></i>
                    </div>
                  </div>
                  <p class="text-xs text-slate-400 mb-1">Market Alignment</p>
                  <div class="flex items-baseline gap-2 mb-2">
                    <p id="dash-market-align" class="text-3xl font-bold text-slate-50">Good</p>
                  </div>
                  <p id="market-align-detail" class="text-[10px] text-emerald-400 mt-1">Matches 7/10 top jobs</p>
                </div>

                <!-- Target Role -->
                <div class="glass-card rounded-xl p-5 border border-purple-500/20 hover:border-purple-500/40 transition-all duration-300 group animate-scale-in" style="--stagger-delay: 3">
                  <div class="flex items-center justify-between mb-3">
                    <div class="h-12 w-12 rounded-xl bg-purple-500/10 text-purple-300 flex items-center justify-center group-hover:scale-110 transition-all">
                      <i class="fa-solid fa-crosshairs text-lg"></i>
                    </div>
                    <button class="text-[10px] text-purple-400 hover:text-purple-300" onclick="switchView('simulator')">Change</button>
                  </div>
                  <p class="text-xs text-slate-400 mb-1">Target Role</p>
                  <p id="dash-target-role" class="text-lg font-bold text-slate-50 truncate">Full Stack Dev</p>
                  <p class="text-[10px] text-purple-400 mt-1">Simulating...</p>
                </div>

                
              </div>

            <!-- Layout: Subjects + AI Panel -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 items-start">
              <!-- Twin Visualization -->
              <div class="glass-card rounded-2xl p-4 lg:col-span-2">
                <div class="flex items-center justify-between mb-3">
                  <div>
                    <p class="text-xs text-slate-400 uppercase tracking-[0.15em]">
                      Skill-Twin Visualization
                    </p>
                    <h2 class="text-sm font-semibold text-slate-100 mt-1">
                      You vs. Market vs. Curriculum
                    </h2>
                  </div>
                  <div class="flex items-center gap-3">
                    <button id="btn-toggle-chart" class="px-2 py-1 rounded bg-slate-800/60 border border-slate-700 text-[10px] text-slate-300 hover:text-white hover:bg-slate-700 transition">
                        <i class="fa-solid fa-chart-pie mr-1"></i> <span id="chart-toggle-text">View Venn</span>
                    </button>
                    <div class="flex gap-2 text-[10px]">
                        <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-cyan-400"></span> You</span>
                        <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-purple-500"></span> Market</span>
                        <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-slate-500"></span> Syllabus</span>
                    </div>
                  </div>
                </div>
                <div class="relative h-[420px] flex items-center justify-center">
                  <canvas id="twin-radar-chart"></canvas>
                  <!-- Holographic Twin (centered) -->
                  <div id="holo-twin" class="absolute z-20 pointer-events-none" aria-hidden="true">
                    <div class="holo-ring holo-ring-1"></div>
                    <div class="holo-ring holo-ring-2"></div>
                    <div class="holo-core"></div>
                  </div>
                  <!-- Overlay for empty state -->
                  <div id="twin-empty-state" class="absolute inset-0 flex flex-col items-center justify-center bg-slate-900/80 backdrop-blur-sm rounded-xl z-10 hidden">
                    <i class="fa-solid fa-dna text-4xl text-slate-600 mb-3"></i>
                    <p class="text-slate-400 text-sm">Upload Resume & Syllabus to generate Twin</p>
                    <button onclick="switchView('analyzer')" class="mt-3 px-4 py-2 bg-cyan-500/20 text-cyan-400 rounded-lg text-xs border border-cyan-500/40 hover:bg-cyan-500/30 transition">Go to Analyzer</button>
                  </div>
                </div>
              </div>

              <!-- AI Study Companion -->
              <div class="glass-card rounded-2xl p-4 space-y-3">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-xs text-slate-400 uppercase tracking-[0.16em]">
                      AI Career Coach
                    </p>
                    <h2 class="text-sm font-semibold text-slate-100 mt-1">
                      Personalized Insights
                    </h2>
                  </div>
                  <div
                    class="h-9 w-9 rounded-xl bg-purple-500/20 text-purple-300 flex items-center justify-center"
                  >
                    <i class="fa-solid fa-sparkles text-sm"></i>
                  </div>
                </div>
                <div
                  id="dashboard-ai-output"
                  class="mt-2 text-xs leading-relaxed text-slate-300 max-h-72 overflow-y-auto scrollbar-thin prose prose-invert prose-sm prose-slate"
                >
                  <p class="text-slate-400">
                    Click
                    <span class="font-semibold text-emerald-300">“Run Twin Engine”</span>
                    above to generate personalized insights and learning roadmap.
                  </p>
                </div>
              </div>
            </div>
          </section>

          

          <!-- Student Profile View -->
          <section
            data-view="student-profile"
              class="hidden grid grid-cols-1 gap-6 animate-fade-in"
          >
            <header class="flex items-center justify-between">
              <div>
                <div class="flex items-center gap-2 text-xs font-medium uppercase text-sky-300">
                  <span class="inline-flex h-5 w-5 rounded-full bg-sky-500/10 items-center justify-center">
                    <i class="fa-solid fa-id-card text-[11px]"></i>
                  </span>
                  <span>My Profile</span>
                </div>
                <h1 class="mt-1 text-2xl font-semibold text-slate-50">
                  Digital Identity
                </h1>
              </div>
            </header>

              <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
              <!-- Profile Card -->
              <div class="glass-card rounded-2xl p-6 lg:col-span-1 flex flex-col items-center text-center space-y-4">
                <div class="h-24 w-24 rounded-full bg-gradient-to-tr from-sky-500 via-blue-500 to-cyan-500 p-1">
                  <div class="h-full w-full rounded-full bg-slate-900 flex items-center justify-center overflow-hidden">
                    <i class="fa-solid fa-user-graduate text-4xl text-slate-200"></i>
                  </div>
                </div>
                <div>
                  <h2 id="profile-view-name" class="text-xl font-bold text-slate-50"></h2>
                  <p id="profile-view-username" class="text-sm text-slate-400 font-mono"></p>
                  <p id="profile-view-email" class="text-xs text-slate-400 mt-1"></p>
                  
                  <!-- CGPA Section -->
                  <div class="mt-4 pt-4 border-t border-slate-700">
                    <p class="text-[11px] text-slate-500 uppercase tracking-wider mb-2">CGPA Score</p>
                    <div class="flex items-center gap-3 mb-2">
                      <p id="profile-view-cgpa" class="text-2xl font-bold text-emerald-400">—</p>
                      <p id="profile-view-cgpa-status" class="text-[10px] text-slate-400">Not entered</p>
                    </div>
                    <div class="w-full bg-slate-800 rounded-full h-1.5 overflow-hidden border border-slate-700/50">
                      <div id="profile-cgpa-bar" class="h-full bg-slate-600 transition-all duration-300" style="width: 0%"></div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Skills -->
              <div class="lg:col-span-2 space-y-6">
                <div class="glass-card rounded-2xl p-6">
                  <h3 class="text-lg font-semibold text-slate-100 mb-4">My Extracted Skills (from Portfolio)</h3>
                  <div id="profile-resume-skills" class="flex flex-wrap gap-2"></div>
                </div>
                <div class="glass-card rounded-2xl p-6">
                  <h3 class="text-lg font-semibold text-slate-100 mb-4">Academic Skills (from Syllabus)</h3>
                  <div id="profile-syllabus-skills" class="flex flex-wrap gap-2"></div>
                </div>
              </div>
            </div>
          </section>

          <!-- Market Insights View -->
          <section
            data-view="market-insights"
              class="hidden grid grid-cols-1 gap-6 animate-fade-in"
          >
            <header class="flex items-center justify-between">
              <div>
                <div class="flex items-center gap-2 text-xs font-medium uppercase text-rose-300">
                  <span class="inline-flex h-5 w-5 rounded-full bg-rose-500/10 items-center justify-center">
                    <i class="fa-solid fa-globe text-[11px]"></i>
                  </span>
                  <span>Global Market Intelligence</span>
                </div>
                <h1 class="mt-1 text-2xl font-semibold text-slate-50">
                  Real-Time Tech Trends
                </h1>
              </div>
            </header>

            <!-- Top Trends Grid -->
              <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
               <!-- Gen AI Card -->
               <div class="glass-card p-5 rounded-xl border border-purple-500/30 relative overflow-hidden group hover:shadow-purple-500/20 transition duration-500">
                  <div class="absolute -right-4 -top-4 h-20 w-20 bg-purple-500/20 rounded-full blur-xl group-hover:bg-purple-500/30 transition"></div>
                  <h3 class="text-sm font-bold text-slate-100">Generative AI & LLMs</h3>
                  <p class="text-xs text-slate-400 mt-1">Explosive Growth</p>
                  <div class="mt-4 flex items-end gap-2">
                     <span class="text-3xl font-bold text-purple-400">+240%</span>
                     <span class="text-[10px] text-slate-400 mb-1">YoY Demand</span>
                  </div>
                  <div class="mt-2 h-1 w-full bg-slate-800 rounded-full overflow-hidden">
                     <div class="h-full bg-purple-500 w-[90%] animate-pulse"></div>
                  </div>
               </div>
               <!-- Quantum Card -->
               <div class="glass-card p-5 rounded-xl border border-cyan-500/30 relative overflow-hidden group hover:shadow-cyan-500/20 transition duration-500">
                  <div class="absolute -right-4 -top-4 h-20 w-20 bg-cyan-500/20 rounded-full blur-xl group-hover:bg-cyan-500/30 transition"></div>
                  <h3 class="text-sm font-bold text-slate-100">Quantum Computing</h3>
                  <p class="text-xs text-slate-400 mt-1">Emerging Sector</p>
                  <div class="mt-4 flex items-end gap-2">
                     <span class="text-3xl font-bold text-cyan-400">+85%</span>
                     <span class="text-[10px] text-slate-400 mb-1">YoY Demand</span>
                  </div>
                  <div class="mt-2 h-1 w-full bg-slate-800 rounded-full overflow-hidden">
                     <div class="h-full bg-cyan-500 w-[65%]"></div>
                  </div>
               </div>
               <!-- Cybersecurity Card -->
               <div class="glass-card p-5 rounded-xl border border-emerald-500/30 relative overflow-hidden group hover:shadow-emerald-500/20 transition duration-500">
                  <div class="absolute -right-4 -top-4 h-20 w-20 bg-emerald-500/20 rounded-full blur-xl group-hover:bg-emerald-500/30 transition"></div>
                  <h3 class="text-sm font-bold text-slate-100">Cybersecurity (Zero Trust)</h3>
                  <p class="text-xs text-slate-400 mt-1">High Stability</p>
                  <div class="mt-4 flex items-end gap-2">
                     <span class="text-3xl font-bold text-emerald-400">+45%</span>
                     <span class="text-[10px] text-slate-400 mb-1">YoY Demand</span>
                  </div>
                  <div class="mt-2 h-1 w-full bg-slate-800 rounded-full overflow-hidden">
                     <div class="h-full bg-emerald-500 w-[80%]"></div>
                  </div>
               </div>
            </div>

            <!-- Detailed Charts Area -->
              <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
               <div class="glass-card rounded-2xl p-5 lg:col-span-2">
                  <h3 class="text-sm font-semibold text-slate-100 mb-4">Technology Demand Curve (2024-2025)</h3>
                  <div class="relative h-64 w-full">
                     <canvas id="market-trend-chart"></canvas>
                  </div>
               </div>
               <div class="glass-card rounded-2xl p-5">
                  <h3 class="text-sm font-semibold text-slate-100 mb-4">Top Paying Skills</h3>
                  <div class="space-y-3" id="top-paying-skills-list">
                     <!-- Injected via JS -->
                  </div>
               </div>
            </div>
            
            <!-- Live Feed -->
            <div class="glass-card rounded-2xl p-5">
               <div class="flex items-center justify-between mb-4">
                  <h3 class="text-sm font-semibold text-slate-100">Live Job Market Feed</h3>
                  <span class="flex items-center gap-2 text-[10px] text-emerald-400">
                     <span class="relative flex h-2 w-2">
                        <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                        <span class="relative inline-flex rounded-full h-2 w-2 bg-emerald-500"></span>
                     </span>
                     Live Updates
                  </span>
               </div>
               <div class="flex items-center gap-2 mb-4">
                  <div class="relative flex-1">
                     <i class="fa-solid fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 text-xs"></i>
                     <input id="market-search-input" type="text" placeholder="Search roles or tech stack (e.g., 'React', 'AI')..." class="w-full bg-slate-900/60 border border-slate-700/80 rounded-xl py-2 pl-9 pr-4 text-xs focus:outline-none focus:ring-1 focus:ring-emerald-400 text-slate-300">
                  </div>
                  <button id="btn-market-search" class="px-4 py-2 bg-emerald-500/10 text-emerald-400 text-xs rounded-xl border border-emerald-500/30 hover:bg-emerald-500/20 transition">
                     Search
                  </button>
                  <button id="btn-market-clear" class="hidden px-3 py-2 bg-slate-800 text-slate-400 text-xs rounded-xl border border-slate-700 hover:text-white hover:bg-slate-700 transition" title="Clear Search">
                     <i class="fa-solid fa-xmark"></i>
                  </button>
               </div>
               <div class="overflow-x-auto">
                  <table class="w-full text-xs text-left">
                     <thead class="text-slate-400 border-b border-slate-700/50">
                        <tr>
                           <th class="py-2 pl-2">Role</th>
                           <th class="py-2">Tech Stack</th>
                           <th class="py-2">Demand</th>
                           <th class="py-2">Avg Salary</th>
                        </tr>
                     </thead>
                     <tbody id="market-feed-table" class="divide-y divide-slate-800/50 text-slate-300">
                        <!-- Injected -->
                     </tbody>
                  </table>
               </div>
            </div>

            <!-- Supply vs Demand Analysis -->
            <div class="glass-card rounded-2xl p-5">
                <h3 class="text-sm font-semibold text-slate-100 mb-4 flex items-center gap-2">
                    <i class="fa-solid fa-scale-unbalanced text-cyan-400"></i>
                    Local Supply vs. Demand (The FOMO Engine)
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="space-y-3">
                        <h4 class="text-xs font-bold text-rose-400 uppercase tracking-wider flex items-center gap-2"><i class="fa-solid fa-users"></i> Saturated (Crowded)</h4>
                        <div id="saturated-list" class="space-y-2"></div>
                    </div>
                    <div class="space-y-3">
                        <h4 class="text-xs font-bold text-emerald-400 uppercase tracking-wider flex items-center gap-2"><i class="fa-solid fa-gem"></i> High Opportunity (Scarcity)</h4>
                        <div id="opportunity-list" class="space-y-2"></div>
                    </div>
                </div>
            </div>
          </section>

          <!-- Analyzer View -->
          <section
            data-view="analyzer"
              class="hidden grid grid-cols-1 gap-6 animate-fade-in"
          >
            <header class="flex items-center justify-between">
              <div>
                <div class="flex items-center gap-2 text-xs font-medium uppercase text-cyan-300">
                  <span class="inline-flex h-5 w-5 rounded-full bg-cyan-500/10 items-center justify-center">
                    <i class="fa-solid fa-file-import text-[11px]"></i>
                  </span>
                  <span>Data Ingestion</span>
                </div>
                <h1 class="mt-1 text-2xl font-semibold text-slate-50">
                  Twin Engine Input
                </h1>
              </div>
            </header>

              <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
              <!-- Resume Upload -->
              <div class="glass-card rounded-2xl p-6 border border-slate-700/50 hover:border-cyan-500/30 transition">
                <div class="flex items-center gap-3 mb-4">
                  <div class="h-10 w-10 rounded-xl bg-cyan-500/20 text-cyan-300 flex items-center justify-center">
                    <i class="fa-solid fa-user-tie"></i>
                  </div>
                  <div>
                    <h3 class="text-lg font-semibold text-slate-100">Student Portfolio</h3>
                    <p class="text-xs text-slate-400">Resume, GitHub, Certifications</p>
                  </div>
                </div>
                <div class="mb-3">
                  <label class="block text-[10px] text-slate-400 uppercase tracking-wider mb-2">CGPA (0-10 Scale)</label>
                  <div class="space-y-2">
                    <div class="flex items-center gap-3">
                      <input type="number" id="input-student-cgpa" min="0" max="10" step="0.01" placeholder="e.g., 8.5" class="flex-1 bg-slate-900/60 border border-slate-700 rounded-lg py-2 px-4 text-xs text-slate-300 focus:outline-none focus:border-cyan-500 transition" />
                      <span id="cgpa-display" class="text-sm font-semibold text-slate-400 w-12 text-right">—</span>
                    </div>
                    <!-- Progress Bar -->
                    <div class="w-full bg-slate-800 rounded-full h-2 overflow-hidden border border-slate-700/50">
                      <div id="cgpa-progress-bar" class="h-full bg-slate-600 transition-all duration-300" style="width: 0%"></div>
                    </div>
                    <!-- Status Message -->
                    <p id="cgpa-status" class="text-[10px] text-slate-500">Enter CGPA to see assessment</p>
                  </div>
                </div>
                <div class="mb-3">
                  <label class="block text-[10px] text-slate-400 uppercase tracking-wider mb-1">Upload Resume (PDF)</label>
                  <input type="file" id="file-resume" accept=".pdf" class="block w-full text-xs text-slate-400
                    file:mr-4 file:py-2 file:px-4
                    file:rounded-lg file:border-0
                    file:text-xs file:font-semibold
                    file:bg-cyan-500/10 file:text-cyan-400 hover:file:bg-cyan-500/20 transition"/>
                </div>
                <div class="mb-3">
                  <label class="block text-[10px] text-slate-400 uppercase tracking-wider mb-1">Import from URL (GitHub/LinkedIn)</label>
                  <div class="flex items-center gap-2">
                    <div class="relative flex-1">
                        <i class="fa-brands fa-github absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 text-xs"></i>
                        <input type="url" id="input-resume-url" placeholder="https://github.com/username" class="w-full bg-slate-900/60 border border-slate-700 rounded-lg py-2 pl-9 pr-4 text-xs text-slate-300 focus:outline-none focus:border-cyan-500 transition">
                    </div>
                  </div>
                </div>
                <textarea id="input-resume-text" class="w-full h-40 bg-slate-900/60 border border-slate-700 rounded-xl p-3 text-xs text-slate-300 focus:outline-none focus:border-cyan-500 transition resize-none" placeholder="Paste resume text or GitHub profile summary here..."></textarea>
                <div class="mt-4 flex justify-end">
                  <button id="btn-process-resume" class="px-4 py-2 bg-slate-800 hover:bg-slate-700 text-slate-200 text-xs rounded-lg transition border border-slate-600">
                    <i class="fa-solid fa-gear"></i> Process Portfolio
                  </button>
                </div>
              </div>

              <!-- Syllabus Upload -->
              <div class="glass-card rounded-2xl p-6 border border-slate-700/50 hover:border-purple-500/30 transition">
                <div class="flex items-center gap-3 mb-4">
                  <div class="h-10 w-10 rounded-xl bg-purple-500/20 text-purple-300 flex items-center justify-center">
                    <i class="fa-solid fa-book-open"></i>
                  </div>
                  <div>
                    <h3 class="text-lg font-semibold text-slate-100">Academic Curriculum</h3>
                    <p class="text-xs text-slate-400">University Syllabus (PDF/Text)</p>
                  </div>
                </div>
                <div class="mb-3">
                  <label class="block text-[10px] text-slate-400 uppercase tracking-wider mb-1">Upload Syllabus (PDF)</label>
                  <input type="file" id="file-syllabus" accept=".pdf" class="block w-full text-xs text-slate-400
                    file:mr-4 file:py-2 file:px-4
                    file:rounded-lg file:border-0
                    file:text-xs file:font-semibold
                    file:bg-purple-500/10 file:text-purple-400 hover:file:bg-purple-500/20 transition"/>
                </div>
                <div class="mb-3">
                  <label class="block text-[10px] text-slate-400 uppercase tracking-wider mb-1">Import from URL (University Site)</label>
                  <div class="flex items-center gap-2">
                    <div class="relative flex-1">
                        <i class="fa-solid fa-link absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 text-xs"></i>
                        <input type="url" id="input-syllabus-url" placeholder="https://university.edu/syllabus" class="w-full bg-slate-900/60 border border-slate-700 rounded-lg py-2 pl-9 pr-4 text-xs text-slate-300 focus:outline-none focus:border-purple-500 transition">
                    </div>
                  </div>
                </div>
                <textarea id="input-syllabus-text" class="w-full h-40 bg-slate-900/60 border border-slate-700 rounded-xl p-3 text-xs text-slate-300 focus:outline-none focus:border-purple-500 transition resize-none" placeholder="Paste syllabus content or course list here..."></textarea>
                <div class="mt-4 flex justify-end">
                  <button id="btn-process-syllabus" class="px-4 py-2 bg-slate-800 hover:bg-slate-700 text-slate-200 text-xs rounded-lg transition border border-slate-600">
                    <i class="fa-solid fa-gear"></i> Process Syllabus
                  </button>
                </div>
              </div>
            </div>

            <div class="glass-card rounded-2xl p-6 text-center">
              <button id="btn-run-analysis" class="px-8 py-3 bg-gradient-to-r from-cyan-500 to-blue-600 text-white font-bold rounded-xl shadow-lg shadow-cyan-500/30 hover:scale-105 transition transform">
                <i class="fa-solid fa-bolt"></i> Run Gap Analysis
              </button>
              <p class="text-xs text-slate-500 mt-2">Compares Portfolio vs. Syllabus vs. Real-time Market Data</p>
            </div>
          </section>

          <!-- Roadmap View -->
          <section
            data-view="roadmap"
              class="hidden grid grid-cols-1 gap-6 animate-fade-in"
          >
            <header class="flex items-center justify-between">
              <div>
                <div class="flex items-center gap-2 text-xs font-medium uppercase text-emerald-300">
                  <span class="inline-flex h-5 w-5 rounded-full bg-emerald-500/10 items-center justify-center">
                    <i class="fa-solid fa-route text-[11px]"></i>
                  </span>
                  <span>Bridge Course Generator</span>
                </div>
                <h1 class="mt-1 text-2xl font-semibold text-slate-50">
                  Personalized Learning Roadmap
                </h1>
              </div>
            </header>

              <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
              <!-- Timeline -->
              <div class="lg:col-span-2 glass-card rounded-2xl p-6 relative min-h-[500px]">
                <div class="timeline-line"></div>
                <div id="roadmap-container" class="space-y-8 pl-8">
                  <!-- Roadmap items injected here -->
                  <p class="text-slate-400 text-sm">Run analysis to generate roadmap.</p>
                </div>
              </div>

              <!-- Course Recommendations -->
              <div class="glass-card rounded-2xl p-4 space-y-4 h-fit">
                <h3 class="text-sm font-semibold text-slate-100 border-b border-slate-700 pb-2">Recommended Resources</h3>
                <div id="course-recommendations" class="space-y-3">
                  <!-- Injected -->
                  <div class="p-3 rounded-lg bg-slate-900/50 border border-slate-800">
                    <p class="text-xs text-slate-500">Waiting for analysis...</p>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- Role Simulator View -->
          <section
            data-view="simulator"
              class="hidden grid grid-cols-1 gap-6 animate-fade-in"
          >
            <header class="flex items-center justify-between">
              <div>
                <div class="flex items-center gap-2 text-xs font-medium uppercase text-purple-300">
                  <span class="inline-flex h-5 w-5 rounded-full bg-purple-500/10 items-center justify-center">
                    <i class="fa-solid fa-vr-cardboard text-[11px]"></i>
                  </span>
                  <span>Role Simulator</span>
                </div>
                <h1 class="mt-1 text-2xl font-semibold text-slate-50">
                  Career Path Simulation
                </h1>
              </div>
            </header>

            <div class="glass-card rounded-2xl p-6 mb-6">
              <label class="text-sm text-slate-300 block mb-2">Select Target Role to Simulate</label>
              <select id="role-selector" class="w-full md:w-1/2 bg-slate-900 border border-slate-700 rounded-xl px-4 py-3 text-slate-100 focus:border-purple-500 outline-none">
                <option value="Full Stack Developer">Full Stack Developer</option>
                <option value="Data Scientist">Data Scientist</option>
                <option value="AI Engineer">AI Engineer</option>
                <option value="DevOps Engineer">DevOps Engineer</option>
                <option value="Cyber Security Analyst">Cyber Security Analyst</option>
                <option value="Cloud Architect">Cloud Architect</option>
                <option value="Blockchain Developer">Blockchain Developer</option>
                <option value="Prompt Engineer">Prompt Engineer</option>
                <option value="Quantum Researcher">Quantum Researcher</option>
                <option value="AR/VR Developer">AR/VR Developer</option>
              </select>
            </div>

              <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
              <div class="glass-card rounded-2xl p-6 border border-purple-500/20">
                <h3 class="text-lg font-semibold text-slate-100 mb-4">Role Requirements</h3>
                <div id="sim-req-skills" class="flex flex-wrap gap-2"></div>
              </div>
              <div class="glass-card rounded-2xl p-6 border border-rose-500/20">
                <h3 class="text-lg font-semibold text-slate-100 mb-4">Your Missing Competencies</h3>
                <div id="sim-missing-skills" class="flex flex-wrap gap-2"></div>
              </div>
            </div>

            <div class="glass-card rounded-2xl p-6">
              <h3 class="text-lg font-semibold text-slate-100 mb-2">Estimated Transition Cost</h3>
              <div class="flex items-center gap-8">
                <div>
                  <p class="text-xs text-slate-400">Time to Readiness</p>
                  <p id="sim-time" class="text-2xl font-bold text-slate-50">0 Weeks</p>
                </div>
                <div>
                  <p class="text-xs text-slate-400">Learning Effort</p>
                  <p id="sim-effort" class="text-2xl font-bold text-slate-50">High</p>
                </div>
              </div>
            </div>
          </section>

          <!-- Notifications View (shared) -->
          <section
            data-view="notifications-view"
              class="hidden flex-col gap-8 animate-fade-in"
          >
            <header class="flex items-center justify-between">
              <div>
                <div class="flex items-center gap-2 text-xs font-medium uppercase text-amber-300">
                  <span class="inline-flex h-5 w-5 rounded-full bg-amber-500/10 items-center justify-center">
                    <i class="fa-solid fa-bell text-[11px]"></i>
                  </span>
                  <span>Notifications</span>
                </div>
                <h1 class="mt-1 text-2xl font-semibold text-slate-50">
                  All recent notices
                </h1>
              </div>
              <button
                id="btn-back-from-notifications"
                class="inline-flex items-center gap-2 px-3 py-2 rounded-xl bg-slate-900/70 border border-slate-700/70 text-xs text-slate-200 hover:border-emerald-400/70 transition"
              >
                <i class="fa-solid fa-arrow-left"></i>
                <span>Back</span>
              </button>
            </header>
            <div
              id="notifications-view-list"
              class="glass-card rounded-2xl p-4 text-xs text-slate-300 max-h-[520px] overflow-y-auto space-y-2 scrollbar-thin mt-2"
            >
              <!-- Notices injected -->
            </div>
          </section>

        </main>
      </div>
    </div>

    <!-- AI Chat Assistant (Floating) -->
    <div
      id="ai-chat-widget"
      class="fixed bottom-6 right-6 z-50 hidden flex-col gap-3"
    >
      <div
        id="ai-chat-window"
        class="glass-card rounded-2xl p-4 w-80 h-96 flex flex-col shadow-2xl border border-violet-500/30 hidden"
      >
        <div class="flex items-center justify-between mb-3 pb-2 border-b border-slate-800">
          <div class="flex items-center gap-2">
            <div class="h-8 w-8 rounded-xl bg-gradient-to-tr from-violet-500 to-indigo-500 flex items-center justify-center">
              <i class="fa-solid fa-robot text-xs"></i>
            </div>
            <div>
              <p class="text-xs font-semibold text-slate-100">Skill-Twin AI</p>
              <p class="text-[10px] text-slate-400">Career & Gap Analysis</p>
            </div>
          </div>
          <button
            id="ai-chat-close"
            class="h-6 w-6 rounded-lg bg-slate-800/80 hover:bg-slate-700 text-slate-400 flex items-center justify-center transition"
          >
            <i class="fa-solid fa-times text-[10px]"></i>
          </button>
        </div>
        <div
          id="ai-chat-messages"
          class="flex-1 overflow-y-auto scrollbar-thin space-y-2 text-xs text-slate-300 mb-3"
        >
          <div class="flex items-start gap-2">
            <div class="h-6 w-6 rounded-lg bg-violet-500/20 flex items-center justify-center shrink-0">
              <i class="fa-solid fa-robot text-[10px] text-violet-300"></i>
            </div>
            <div class="bg-slate-900/60 rounded-lg px-2.5 py-1.5">
              <p>Hello! I'm your Skill-Twin AI. I can help you analyze your resume against job roles or suggest courses.</p>
            </div>
          </div>
        </div>
        <div class="flex items-center gap-2">
          <input
            id="ai-chat-input"
            type="text"
            placeholder="Type your question..."
            class="flex-1 text-xs px-3 py-2 rounded-xl bg-slate-900/60 border border-slate-700/80 focus:outline-none focus:ring-1 focus:ring-violet-400"
          />
          <button
            id="ai-chat-send"
            class="h-8 w-8 rounded-xl bg-gradient-to-r from-violet-500 to-indigo-500 text-white flex items-center justify-center hover:from-violet-600 hover:to-indigo-600 transition"
          >
            <i class="fa-solid fa-paper-plane text-[10px]"></i>
          </button>
        </div>
      </div>
      <button
        id="ai-chat-button"
        class="h-14 w-14 rounded-2xl bg-gradient-to-tr from-violet-500 via-indigo-500 to-purple-500 shadow-lg shadow-violet-500/50 flex items-center justify-center text-white hover:scale-110 transition animate-float"
      >
        <i class="fa-solid fa-robot text-xl"></i>
        <span
          id="ai-chat-indicator"
          class="absolute top-0 right-0 h-3 w-3 rounded-full bg-emerald-400 border-2 border-slate-900 animate-pulse"
        ></span>
      </button>
    </div>

    <!-- Login Screen -->
    <div
      id="login-view"
      class="hidden min-h-screen flex items-center justify-center px-4 py-10 animate-fade-in"
      style="position:fixed; inset:0; z-index:9999;"
    >
      <!-- Backdrop to ensure login is in front -->
      <div style="position:absolute; inset:0; background:rgba(2,6,23,0.7); backdrop-filter:blur(4px);"></div>
      <div
        class="glass-card w-full max-w-md rounded-3xl p-6 md:p-8 border border-slate-800/80 relative overflow-hidden"
        style="position:relative; z-index:10000;"
      >
        <div
          class="absolute -right-10 -top-10 h-32 w-32 rounded-full bg-gradient-to-tr from-indigo-500 via-purple-500 to-emerald-400 opacity-60 blur-3xl"
        ></div>
        <div class="relative">
          <div class="flex items-center gap-3 mb-4">
            <div
              class="h-11 w-11 rounded-2xl bg-gradient-to-tr from-cyan-500 via-blue-500 to-purple-500 flex items-center justify-center animate-float"
            >
              <i class="fa-solid fa-dna text-lg text-white"></i>
            </div>
            <div>
              <p class="text-[10px] uppercase tracking-[0.3em] text-cyan-400 font-bold">
                AI-Powered
              </p>
              <h1 class="text-xl font-semibold text-slate-50">
                Skill-Twin Engine
              </h1>
            </div>
          </div>
          <p class="text-sm text-slate-400 mb-5">
            Analyze employability gaps, simulate job roles, and generate
            <span class="text-cyan-300 font-medium">AI Roadmaps</span> to bridge the gap between
            <span class="text-purple-300 font-medium">Academia</span> and <span class="text-emerald-300 font-medium">Industry</span>.
          </p>

          <form id="login-form" class="space-y-4">
            <div class="space-y-1 text-sm">
              <label for="username" class="text-slate-200">Username</label>
              <div
                class="flex items-center gap-2 rounded-2xl bg-slate-900/70 border border-slate-700/80 px-3 py-2 focus-within:ring-1 focus-within:ring-emerald-400"
              >
                <i class="fa-solid fa-user text-slate-500 text-xs"></i>
                <input
                  id="username"
                  type="text"
                  autocomplete="username"
                  class="bg-transparent outline-none border-none text-sm flex-1 text-slate-100 placeholder:text-slate-500"
                placeholder="e.g., student"
                  required
                />
              </div>
            </div>

            <div class="space-y-1 text-sm">
              <label for="password" class="text-slate-200">Password</label>
              <div
                class="flex items-center gap-2 rounded-2xl bg-slate-900/70 border border-slate-700/80 px-3 py-2 focus-within:ring-1 focus-within:ring-emerald-400"
              >
                <i class="fa-solid fa-lock text-slate-500 text-xs"></i>
                <input
                  id="password"
                  type="password"
                  autocomplete="current-password"
                  class="bg-transparent outline-none border-none text-sm flex-1 text-slate-100 placeholder:text-slate-500"
                  placeholder="password"
                  required
                />
              </div>
            </div>

            <button
              type="submit"
              class="w-full mt-2 inline-flex items-center justify-center gap-2 rounded-2xl bg-gradient-to-r from-emerald-500 via-teal-400 to-cyan-500 text-slate-950 font-semibold text-sm py-2.5 shadow-lg shadow-emerald-500/30 hover:shadow-emerald-400/50 transition"
            >
              <span
                id="login-spinner"
                class="hidden h-4 w-4 rounded-full border-2 border-slate-900 border-t-transparent animate-spin-soft"
              ></span>
              <span>Sign in</span>
            </button>

            <p class="text-[11px] text-slate-500 mt-2 leading-relaxed">
              Demo accounts are generated automatically on first launch.
              <br />
              Try Demo Account:
              <span class="text-slate-300 font-medium">student / password</span>.
            </p>
          </form>
        </div>
      </div>
    </div>

    <script>
      /**********************
       * Mock "Database" & Skill Engine Data
       **********************/

      const DB_KEY = "skill_twin_db_v1";
      const SESSION_KEY = "skill_twin_session";

      /**
       * Load DB from localStorage or initialize with seed data.
       */
      function loadDB() {
        try {
          const raw = localStorage.getItem(DB_KEY);
          if (raw) {
            const parsed = JSON.parse(raw);
            if (parsed && Array.isArray(parsed.users) && Array.isArray(parsed.notifications)) {
              return parsed;
            }
          }
        } catch (e) {
          console.warn("Failed to parse DB, resetting.", e);
        }
        const seeded = seedDatabase();
        saveDB(seeded);
        return seeded;
      }

      function saveDB(db) {
        localStorage.setItem(DB_KEY, JSON.stringify(db));
      }

      function seedDatabase() {
        const users = [];
        const notifications = [];
        const marketData = [];

        // Create a single student user for the demo
        users.push({
          id: 1,
          username: "student",
          password: "password",
          role: "STUDENT",
          fullName: "Alex Doe",
          email: "alex.doe@example.com",
          cgpa: null,
        });

        // Seed a few notifications
        const now = new Date();
        const today = now.toISOString().slice(0, 10);

        notifications.push({
          id: Date.now(),
          title: "Welcome to the Skill-Twin Engine!",
          msg: "Upload your resume and syllabus in the 'Twin Analyzer' to get started.",
          date: today,
          author: "System",
        });

        marketData.push({
          id: Date.now(),
          role: "Full Stack Developer",
          trend: "Up",
          skills: ["React", "Node.js", "MongoDB", "Docker", "AWS"]
        });

        return { users, notifications, marketData, records: [] }; // records is empty
      }

      function randomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
      }

      function animateValue(element, start, end, duration, suffix = "") {
        if (!element) return;
        const startTime = performance.now();
        const animate = (currentTime) => {
          const elapsed = currentTime - startTime;
          const progress = Math.min(elapsed / duration, 1);
          const easeOutCubic = 1 - Math.pow(1 - progress, 3);
          const current = start + (end - start) * easeOutCubic;
          element.textContent = current.toFixed(1) + suffix;
          if (progress < 1) {
            requestAnimationFrame(animate);
          } else {
            element.textContent = end.toFixed(1) + suffix;
          }
        };
        requestAnimationFrame(animate);
      }

      /**********************
       * State & Utilities
       **********************/

      let db = loadDB();
      let currentUser = null;
      let twinRadarChart = null;
      let marketTrendChart = null;
      let isDarkMode = true;
      let aiChatOpen = false;
      let isVennView = false;
      
      // Skill Engine State
      let currentSyllabusSkills = ["Python", "C++", "Data Structures", "Algorithms", "SQL", "Operating Systems"]; // Default mock
      let currentResumeSkills = ["Python", "HTML", "CSS", "JavaScript"]; // Default mock
      let currentTargetRole = "Full Stack Developer";
      let currentStudentCGPA = null;

      const ROLE_SKILLS = {
        "Full Stack Developer": ["JavaScript", "React", "Node.js", "SQL", "MongoDB", "Docker", "AWS"],
        "Data Scientist": ["Python", "SQL", "Machine Learning", "Statistics", "Pandas", "TensorFlow", "Tableau"],
        "AI Engineer": ["Python", "Deep Learning", "NLP", "PyTorch", "Cloud Computing", "MLOps", "Linear Algebra"],
        "DevOps Engineer": ["Linux", "Docker", "Kubernetes", "CI/CD", "AWS", "Python", "Bash"],
        "Cyber Security Analyst": ["Networking", "Linux", "Python", "Ethical Hacking", "Cryptography", "SIEM", "Firewalls"],
        "Cloud Architect": ["AWS", "Azure", "Terraform", "Kubernetes", "Networking", "Security", "Linux"],
        "Blockchain Developer": ["Solidity", "Rust", "Smart Contracts", "Web3.js", "Cryptography", "Ethereum"],
        "Prompt Engineer": ["LLMs", "Python", "NLP", "Creative Writing", "Data Analysis", "API Integration"],
        "Quantum Researcher": ["Quantum Mechanics", "Linear Algebra", "Python", "Qiskit", "C++", "Physics"],
        "AR/VR Developer": ["Unity", "C#", "3D Math", "Unreal Engine", "C++", "Computer Graphics"]
      };

      const SCARCITY_DATA = [
        { skill: "React.js", supply: 412, demand: 85, salary: "₹8 LPA", type: "saturated" },
        { skill: "Python (Basic)", supply: 650, demand: 200, salary: "₹7 LPA", type: "saturated" },
        { skill: "Rust (WASM)", supply: 3, demand: 14, salary: "₹24 LPA", type: "opportunity" },
        { skill: "Cobol (Legacy)", supply: 1, demand: 22, salary: "₹18 LPA", type: "opportunity" },
        { skill: "AI Ethics", supply: 12, demand: 45, salary: "₹22 LPA", type: "opportunity" }
      ];

      const DEFAULT_MARKET_FEEDS = [
        { role: "Prompt Engineer", stack: "GPT-4, Python", demand: "Very High", salary: "₹18 LPA" },
        { role: "Quantum Algo Researcher", stack: "Qiskit, Python", demand: "High", salary: "₹35 LPA" },
        { role: "AI Ethicist", stack: "Policy, NLP", demand: "Medium", salary: "₹22 LPA" },
        { role: "DevSecOps Engineer", stack: "Docker, K8s", demand: "High", salary: "₹28 LPA" },
        { role: "Smart Contract Dev", stack: "Solidity, Hardhat", demand: "High", salary: "₹30 LPA" },
        { role: "Full Stack Developer", stack: "MERN, Next.js", demand: "Very High", salary: "₹12 LPA" },
        { role: "Data Scientist", stack: "Python, TensorFlow", demand: "High", salary: "₹18 LPA" },
        { role: "Cloud Architect", stack: "AWS, Azure", demand: "High", salary: "₹32 LPA" },
        { role: "Cybersecurity Analyst", stack: "SIEM, Python", demand: "High", salary: "₹14 LPA" },
        { role: "ML Engineer", stack: "PyTorch, Scikit", demand: "High", salary: "₹20 LPA" },
        { role: "Blockchain Developer", stack: "Rust, Solidity", demand: "Medium", salary: "₹25 LPA" },
        { role: "AR/VR Developer", stack: "Unity, C#", demand: "Medium", salary: "₹16 LPA" },
        { role: "Rust Systems Dev", stack: "Rust, C++", demand: "High", salary: "₹24 LPA" },
        { role: "Golang Backend", stack: "Go, Microservices", demand: "High", salary: "₹22 LPA" },
        { role: "K8s Administrator", stack: "Kubernetes, Helm", demand: "High", salary: "₹26 LPA" },
        { role: "NLP Specialist", stack: "HuggingFace, Spacy", demand: "High", salary: "₹21 LPA" },
        { role: "Big Data Engineer", stack: "Spark, Hadoop", demand: "Medium", salary: "₹19 LPA" }
      ];

      // Extended Skill DB for Extraction
      const SKILL_DB = [
        "Python", "Java", "C++", "JavaScript", "React", "Node.js", "SQL", "MongoDB", 
        "AWS", "Docker", "Machine Learning", "Data Structures", "Algorithms", 
        "Communication", "Git", "CSS", "HTML", "TypeScript", "Go", "Rust", 
        "Kubernetes", "Terraform", "Linux", "Azure", "GCP", "Tableau", "Power BI", 
        "Excel", "Statistics", "Calculus", "Linear Algebra", "Deep Learning", "NLP", 
        "Computer Vision", "Cyber Security", "Networking", "Ethical Hacking", 
        "DevOps", "CI/CD", "Agile", "Scrum", "Jira", "Figma", "Redux", "Express",
        "Django", "Flask", "Spring Boot", "Hibernate", "PostgreSQL", "MySQL", "Oracle"
      ];

      function showToast(message, type = "error") {
        const toast = document.getElementById("toast");
        const msg = document.getElementById("toast-message");
        const icon = document.getElementById("toast-icon");
        msg.textContent = message;
        if (type === "success") {
          icon.innerHTML = '<i class="fa-solid fa-circle-check"></i>';
          icon.className = "text-emerald-400";
        } else if (type === "info") {
          icon.innerHTML = '<i class="fa-solid fa-circle-info"></i>';
          icon.className = "text-sky-400";
        } else {
          icon.innerHTML = '<i class="fa-solid fa-circle-exclamation"></i>';
          icon.className = "text-rose-400";
        }
        toast.classList.remove("hidden", "opacity-0");
        toast.classList.add("animate-fade-in");
        setTimeout(() => {
          toast.classList.add("opacity-0");
          setTimeout(() => {
            toast.classList.add("hidden");
            toast.classList.remove("opacity-0");
          }, 200);
        }, 2600);
      }

      /**********************
       * Theme Management
       **********************/

      function initTheme() {
        const saved = localStorage.getItem("apt_theme");
        if (saved === "light") {
          toggleTheme();
        }
      }

      function toggleTheme() {
        isDarkMode = !isDarkMode;
        document.body.classList.toggle("light-mode");
        const themeIcon = document.querySelector("#theme-toggle i");
        if (themeIcon) {
          themeIcon.className = isDarkMode ? "fa-solid fa-moon" : "fa-solid fa-sun";
        }
        localStorage.setItem("apt_theme", isDarkMode ? "dark" : "light");
      }

      /**********************
       * AI Chat Assistant
       **********************/

      function toggleAIChat() {
        aiChatOpen = !aiChatOpen;
        const widget = document.getElementById("ai-chat-widget");
        const window = document.getElementById("ai-chat-window");
        if (aiChatOpen) {
          widget.classList.remove("hidden");
          window.classList.remove("hidden");
        } else {
          window.classList.add("hidden");
        }
      }

      async function sendAIMessage(message) {
        if (!currentUser) return;
        const messagesContainer = document.getElementById("ai-chat-messages");
        const userMsg = document.createElement("div");
        userMsg.className = "flex items-start gap-2 justify-end";
        userMsg.innerHTML = `
          <div class="bg-emerald-500/20 rounded-lg px-2.5 py-1.5 max-w-[80%]">
            <p class="text-xs text-slate-100">${message}</p>
          </div>
          <div class="h-6 w-6 rounded-lg bg-emerald-500/20 flex items-center justify-center shrink-0">
            <i class="fa-solid fa-user text-[10px] text-emerald-300"></i>
          </div>
        `;
        messagesContainer.appendChild(userMsg);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;

        const botMsg = document.createElement("div");
        botMsg.className = "flex items-start gap-2";
        botMsg.innerHTML = `
          <div class="h-6 w-6 rounded-lg bg-violet-500/20 flex items-center justify-center shrink-0">
            <i class="fa-solid fa-robot text-[10px] text-violet-300"></i>
          </div>
          <div class="bg-slate-900/60 rounded-lg px-2.5 py-1.5">
            <p class="text-xs text-slate-300">Analyzing...</p>
          </div>
        `;
        messagesContainer.appendChild(botMsg);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;

        // Get skill twin related response (no Gemini call)
        const response = generateSkillTwinResponse(message.toLowerCase());
        
        botMsg.innerHTML = `
          <div class="h-6 w-6 rounded-lg bg-violet-500/20 flex items-center justify-center shrink-0">
            <i class="fa-solid fa-robot text-[10px] text-violet-300"></i>
          </div>
          <div class="bg-slate-900/60 rounded-lg px-2.5 py-1.5 prose prose-invert prose-sm text-xs">
            <p>${response}</p>
          </div>
        `;
        
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }

      function generateSkillTwinResponse(message) {
        const analysis = analyzeSkillGap(currentTargetRole);

        // Skill gap & status queries
        if (message.includes("gap") || message.includes("missing") || message.includes("need")) {
          if (analysis.missing.length === 0) {
            return `✓ Great! You already have all skills for <strong>${currentTargetRole}</strong>. Your readiness is <strong>${analysis.readinessScore}%</strong>.`;
          }
          return `Missing <strong>${analysis.missing.length}</strong> skills: <strong>${analysis.missing.slice(0, 3).join(", ")}</strong>${analysis.missing.length > 3 ? "..." : ""}. Focus on these to be job-ready.`;
        }

        // Roadmap queries
        if (message.includes("roadmap") || message.includes("plan") || message.includes("learn")) {
          if (analysis.missing.length === 0) {
            return `You're ready for <strong>${currentTargetRole}</strong>! Consider specializing in an adjacent role or learning new tools.`;
          }
          const next = analysis.missing[0];
          return `Start with <strong>${next}</strong>. 1) Learn theory (2 weeks), 2) Build a mini-project (1 week), 3) Contribute to open source. This bridges 20%+ of your gap.`;
        }

        // Market insights
        if (message.includes("market") || message.includes("job") || message.includes("trend") || message.includes("salary")) {
          const topJobs = [
            { role: "Full Stack Developer", salary: "₹18 LPA", demand: "High" },
            { role: "Backend Engineer", salary: "₹20 LPA", demand: "High" },
            { role: "DevOps Engineer", salary: "₹22 LPA", demand: "High" },
            { role: "ML Engineer", salary: "₹25 LPA", demand: "High" }
          ];
          return `Market snapshot: <strong>${currentTargetRole}</strong> roles are <strong>High demand</strong>. Top markets: Bangalore, Hyderabad, Delhi. Avg salary: ₹18-25 LPA. Your alignment: <strong>${analysis.readinessScore}%</strong>.`;
        }

        // Readiness & assessment
        if (message.includes("readiness") || message.includes("ready") || message.includes("assess")) {
          const status = analysis.readinessScore >= 75 ? "Ready! Target job applications." : analysis.readinessScore >= 50 ? "Almost there. 3-4 weeks of focused learning." : "Build foundations first. 2-3 months recommended.";
          return `Your readiness for <strong>${currentTargetRole}</strong>: <strong>${analysis.readinessScore}%</strong>. ${status}`;
        }

        // Skill recommendations
        if (message.includes("skill") || message.includes("recommend") || message.includes("suggest")) {
          if (analysis.missing.length > 0) {
            return `Top 3 to learn: <strong>${analysis.missing.slice(0, 3).join(", ")}</strong>. Each takes 2-4 weeks with daily practice. Priority: ${analysis.missing[0]}.`;
          }
          return `You're strong in core skills! Next: <strong>Advanced specialization</strong> (Machine Learning, DevOps, or System Design).`;
        }

        // Portfolio help
        if (message.includes("portfolio") || message.includes("project") || message.includes("build")) {
          return `Build projects using your <strong>current skills</strong> (${currentResumeSkills.slice(0, 3).join(", ")}) to strengthen your resume. Target: 2-3 end-to-end projects.`;
        }

        // Syllabus & curriculum
        if (message.includes("course") || message.includes("syllabus") || message.includes("curriculum")) {
          const covered = analysis.coveredBySyllabus.length;
          return `Your syllabus covers <strong>${covered}</strong> of <strong>${analysis.required.length}</strong> required skills. Upload your syllabus PDF to see detailed alignment.`;
        }

        // Help / about
        if (message.includes("help") || message.includes("hello") || message.includes("hi")) {
          return `Hi ${currentUser.fullName}! 👋 I'm your **Skill-Twin AI**. I can help with: skill gaps, roadmaps, market insights, readiness scores, and project ideas. Ask me anything about becoming a <strong>${currentTargetRole}</strong>!`;
        }

        // Default response
        return `I analyzed your profile for <strong>${currentTargetRole}</strong>. Your readiness: <strong>${analysis.readinessScore}%</strong>. Try asking about gaps, roadmaps, market, or specific skills!`;
      }

      /**********************
       * Notification Badge
       **********************/

      function updateNotificationBadge() {
        const badge = document.getElementById("notification-badge");
        if (!badge) return;
        const count = db.notifications.length;
        if (count > 0) {
          badge.textContent = count > 9 ? "9+" : count;
          badge.classList.remove("hidden");
        } else {
          badge.classList.add("hidden");
        }
      }

      /**********************
       * Keyboard Shortcuts
       **********************/

      function setupKeyboardShortcuts() {
        document.addEventListener("keydown", (e) => {
          if (e.target.tagName === "INPUT" || e.target.tagName === "TEXTAREA") return;
          if (e.key === "t" || e.key === "T") {
            e.preventDefault();
            toggleTheme();
          }
          if (e.key === "a" || e.key === "A") {
            e.preventDefault();
            toggleAIChat();
          }
          if (e.key === "e" || e.key === "E") {
            if (currentUser?.role === "STUDENT") {
              e.preventDefault();
              exportStudentReport();
            }
          }
        });
      }

      /**********************
       * Simple Router
       **********************/

      function switchView(viewId) {
        const allViews = document.querySelectorAll("[data-view]");
        allViews.forEach((el) => {
          el.classList.add("hidden");
        });
        const target = document.querySelector('[data-view="' + viewId + '"]');
        if (target) {
          target.classList.remove("hidden");
        }
        
        // Update breadcrumbs
        updateBreadcrumbs(viewId);
        
        // Update active nav
        document.querySelectorAll('[data-nav]').forEach(btn => {
          btn.classList.remove('bg-emerald-500/10', 'border', 'border-emerald-500/20');
        });
        const activeNav = document.querySelector(`[data-nav="${viewId}"]`);
        if (activeNav) {
          activeNav.classList.add('bg-emerald-500/10', 'border', 'border-emerald-500/20');
        }
      }

      function updateBreadcrumbs(viewId) {
        const breadcrumb = document.getElementById("breadcrumb-current");
        const viewNames = {
          "dashboard": "Dashboard",
          "analyzer": "Twin Analyzer",
          "roadmap": "AI Roadmap",
          "market-insights": "Market Insights",
          "simulator": "Role Simulator",
          "student-profile": "My Profile",
          "notifications-view": "Notifications"
        };
        if (breadcrumb) {
          breadcrumb.textContent = viewNames[viewId] || "Dashboard";
        }
      }

      function showLogin() {
        document.getElementById("login-view").classList.remove("hidden");
        document.getElementById("app-shell").classList.add("hidden");
        document.getElementById("ai-chat-widget").classList.add("hidden");
      }

      function showAppShell() {
        document.getElementById("login-view").classList.add("hidden");
        document.getElementById("app-shell").classList.remove("hidden");
        document.getElementById("ai-chat-widget").classList.remove("hidden");
      }

      function updateSidebarForUser() {
        const sidebarRole = document.getElementById("sidebar-role");
        const sidebarUser = document.getElementById("sidebar-user");
        const navLinks = document.getElementById("nav-links");

        sidebarRole.textContent = currentUser
          ? currentUser.role === "ADMIN"
            ? "Administrator"
            : currentUser.role === "FACULTY"
            ? "Curriculum Planner"
            : "Learner"
          : "";
        sidebarUser.textContent = currentUser ? currentUser.fullName : "";

        navLinks.innerHTML = "";
        if (!currentUser) return;

        const makeLink = (id, icon, label, isActive = false) => {
          const li = document.createElement("li");
          li.innerHTML = `
            <button data-nav="${id}" class="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-300 hover:bg-slate-800/80 text-sm transition group ${isActive ? 'bg-emerald-500/10 border border-emerald-500/20' : ''}">
              <span class="h-8 w-8 rounded-lg bg-slate-900/80 text-slate-400 flex items-center justify-center group-hover:text-emerald-300 group-hover:bg-slate-900/90 transition">
                <i class="${icon} text-sm"></i>
              </span>
              <span class="font-medium">${label}</span>
            </button>
          `;
          return li;
        };

        if (currentUser.role === "STUDENT") {
          navLinks.appendChild(makeLink("dashboard", "fa-solid fa-gauge-high", "Dashboard", true));
          navLinks.appendChild(makeLink("analyzer", "fa-solid fa-microchip", "Twin Analyzer"));
          navLinks.appendChild(makeLink("roadmap", "fa-solid fa-route", "AI Roadmap"));
          navLinks.appendChild(makeLink("simulator", "fa-solid fa-vr-cardboard", "Role Simulator"));
          navLinks.appendChild(makeLink("student-profile", "fa-solid fa-id-card", "My Profile"));
        }

        // Attach click handlers
        navLinks.querySelectorAll("button[data-nav]").forEach((btn) => {
          btn.addEventListener("click", () => {
            const targetView = btn.getAttribute("data-nav");
            switchView(targetView);
            
            if (targetView === "dashboard") renderStudentDashboard();
            if (targetView === "analyzer") renderTwinRadarChart();
            if (targetView === "simulator") renderSimulator();
            if (targetView === "roadmap") generateRoadmapUI();
            if (targetView === "student-profile") renderStudentProfilePage();
            if (targetView === "market-insights") renderMarketInsights();
            // Close sidebar on mobile
            if (window.innerWidth < 768) {
              document.getElementById("sidebar").classList.add("hidden");
            }
          });
        });
      }

      /**********************
       * AI Integration (Placeholder)
       **********************/

      const GEMINI_API_KEY = "AIzaSyC59Ist3QTe58OdGDSvkWvxFgEfZaSvylA";

      async function callGemini(prompt, useSearch = false) {
        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`;
        
        const requestBody = {
          contents: [{
            parts: [{ text: prompt }]
          }]
        };

        if (useSearch) {
          requestBody.tools = [{ google_search_retrieval: { dynamic_retrieval_config: { mode: "MODE_DYNAMIC", dynamic_threshold: 0.6 } } }];
        }
        
        try {
          const response = await fetch(url, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(requestBody)
          });

          if (!response.ok) {
            throw new Error(`API Error: ${response.status}. Check your API Key.`);
          }

          const data = await response.json();
          return data.candidates[0].content.parts[0].text;
        } catch (error) {
          console.error("Gemini API Error:", error);
          return "### AI Service Unavailable\n\n" +
            "Unable to connect to the AI service (" + error.message + ").\n\n" +
            "**Simulated Response:**\n" +
            "This is a placeholder response because the API call failed. " +
            "In a production environment, check your API key and network connection.\n\n" +
            "> " + prompt.substring(0, 100) + "...";
        }
      }

      /**********************
       * GitHub Profile Fetcher
       **********************/

      async function fetchGitHubProfile(profileUrl) {
        try {
          const u = new URL(profileUrl);
          const host = u.hostname.toLowerCase();
          if (!host.includes('github.com')) throw new Error('Not a GitHub URL');
          const parts = u.pathname.replace(/^\//, '').split('/').filter(Boolean);
          if (parts.length < 1) throw new Error('Invalid GitHub URL');
          const username = parts[0];

          const headers = { 'Accept': 'application/vnd.github.v3+json' };

          const userResp = await fetch(`https://api.github.com/users/${username}`, { headers });
          if (!userResp.ok) throw new Error('GitHub user not found');
          const user = await userResp.json();

          const reposResp = await fetch(`https://api.github.com/users/${username}/repos?per_page=100&type=owner&sort=pushed`, { headers });
          const repos = reposResp.ok ? await reposResp.json() : [];

          let summary = `GitHub profile for ${user.login}`;
          if (user.name) summary += ` - ${user.name}`;
          if (user.bio) summary += `. Bio: ${user.bio}`;
          if (user.location) summary += `. Location: ${user.location}`;

          if (Array.isArray(repos) && repos.length > 0) {
            summary += `. Repositories (${repos.length}): `;
            const repoParts = repos.map(r => {
              const desc = r.description ? `: ${r.description}` : '';
              const lang = r.language ? ` [${r.language}]` : '';
              return `${r.name}${desc}${lang}`;
            });
            summary += repoParts.join('; ');
          }

          const languages = {};
          if (Array.isArray(repos)) {
            repos.forEach(r => { if (r.language) languages[r.language] = (languages[r.language] || 0) + 1; });
          }
          const topLangs = Object.entries(languages).sort((a,b)=>b[1]-a[1]).slice(0,5).map(e=>e[0]);
          if (topLangs.length) summary += `. Languages: ${topLangs.join(', ')}`;

          return summary;
        } catch (e) {
          console.warn('GitHub fetch failed', e);
          throw e;
        }
      }

      async function fetchGitHubRepo(repoUrl) {
        try {
          const u = new URL(repoUrl);
          const host = u.hostname.toLowerCase();
          if (!host.includes('github.com')) throw new Error('Not a GitHub URL');
          const parts = u.pathname.replace(/^\//, '').split('/').filter(Boolean);
          if (parts.length < 2) throw new Error('Invalid GitHub repo URL');
          const owner = parts[0];
          const repo = parts[1].replace(/\.git$/i, '');

          const headers = { 'Accept': 'application/vnd.github.v3+json' };

          const repoResp = await fetch(`https://api.github.com/repos/${owner}/${repo}`, { headers });
          if (!repoResp.ok) throw new Error('GitHub repo not found');
          const repoInfo = await repoResp.json();

          // Readme (may be base64)
          let readmeText = '';
          const readmeResp = await fetch(`https://api.github.com/repos/${owner}/${repo}/readme`, { headers });
          if (readmeResp.ok) {
            const readmeJson = await readmeResp.json();
            if (readmeJson && readmeJson.content) {
              try {
                readmeText = atob(readmeJson.content.replace(/\n/g, ''));
              } catch (e) {
                // If atob fails, keep raw
                readmeText = readmeJson.content || '';
              }
            }
          }

          // Languages
          const langResp = await fetch(`https://api.github.com/repos/${owner}/${repo}/languages`, { headers });
          const languages = langResp.ok ? await langResp.json() : {};
          const topLangs = Object.keys(languages).slice(0,5);

          let summary = `Repository ${owner}/${repo}`;
          if (repoInfo.description) summary += ` - ${repoInfo.description}`;
          if (repoInfo.homepage) summary += `. Homepage: ${repoInfo.homepage}`;
          if (repoInfo.license && repoInfo.license.name) summary += `. License: ${repoInfo.license.name}`;
          if (topLangs.length) summary += `. Languages: ${topLangs.join(', ')}`;
          if (readmeText) summary += `. README: ${readmeText.substring(0, 2000)}`;

          return summary;
        } catch (e) {
          console.warn('GitHub repo fetch failed', e);
          throw e;
        }
      }

      /**********************
       * Student Rendering
       **********************/

      let marketTickerInterval = null;

      function analyzeSkillGap(role) {
        const required = ROLE_SKILLS[role] || [];
        const studentHas = currentResumeSkills;
        const syllabusHas = currentSyllabusSkills;

        const missing = required.filter(s => !studentHas.includes(s));
        const coveredBySyllabus = required.filter(s => syllabusHas.includes(s));
        const gapInSyllabus = required.filter(s => !syllabusHas.includes(s));
        
        const readinessScore = Math.round(((required.length - missing.length) / required.length) * 100);

        return { required, missing, coveredBySyllabus, gapInSyllabus, readinessScore };
      }

      function renderTwinRadarChart() {
        const ctx = document.getElementById("twin-radar-chart")?.getContext("2d");
        if (!ctx) return;
        if (twinRadarChart) twinRadarChart.destroy();

        // Mock data for radar chart based on current skills
        const labels = ["Coding", "Tools", "Cloud", "Theory", "Soft Skills", "Projects"];
        
        // Simple heuristic to generate scores
        const hasSkill = (s) => currentResumeSkills.some(rs => rs.toLowerCase().includes(s.toLowerCase()));
        
        const studentScore = [
            hasSkill("Python") || hasSkill("Java") || hasSkill("Script") ? 85 : 40,
            hasSkill("Docker") || hasSkill("Git") ? 75 : 30,
            hasSkill("AWS") || hasSkill("Cloud") ? 65 : 20,
            currentSyllabusSkills.length > 5 ? 90 : 50, // Syllabus proxy
            70, // Mock soft skills
            currentResumeSkills.length * 8 // Project proxy
        ];

        const marketScore = [90, 85, 90, 70, 85, 95]; 
        const syllabusScore = [70, 30, 20, 95, 40, 50];

        const isLight = document.body.classList.contains("light-mode");
        const textColor = isLight ? "#0f172a" : "#e5e7eb";

        twinRadarChart = new Chart(ctx, {
          type: "radar",
          data: {
            labels: labels,
            datasets: [
              {
                label: "You (Student)",
                data: studentScore,
                backgroundColor: "rgba(34, 211, 238, 0.2)", // Cyan
                borderColor: "#22d3ee",
                pointBackgroundColor: "#22d3ee",
              },
              {
                label: "Market Demand",
                data: marketScore,
                backgroundColor: "rgba(168, 85, 247, 0.2)", // Purple
                borderColor: "#a855f7",
                pointBackgroundColor: "#a855f7",
              },
              {
                label: "Syllabus Coverage",
                data: syllabusScore,
                backgroundColor: "rgba(148, 163, 184, 0.2)", // Slate
                borderColor: "#94a3b8",
                pointBackgroundColor: "#94a3b8",
                borderDash: [5, 5]
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false }
            },
            scales: {
              r: {
                angleLines: { color: "rgba(148, 163, 184, 0.1)" },
                grid: { color: "rgba(148, 163, 184, 0.1)" },
                pointLabels: {
                  color: textColor,
                  font: { size: 11 }
                },
                ticks: {
                  display: false,
                  backdropColor: "transparent"
                }
              }
            }
          }
        });
      }

      function renderTwinVennChart() {
        const ctx = document.getElementById("twin-radar-chart")?.getContext("2d");
        if (!ctx) return;
        if (twinRadarChart) twinRadarChart.destroy();

        const student = currentResumeSkills;
        const market = ROLE_SKILLS[currentTargetRole] || [];
        const syllabus = currentSyllabusSkills;

        const intersection = (arr1, arr2) => arr1.filter(x => arr2.some(y => y.toLowerCase() === x.toLowerCase()));

        const s_m = intersection(student, market);
        const s_a = intersection(student, syllabus);
        const m_a = intersection(market, syllabus);
        const s_m_a = intersection(s_m, syllabus);

        const data = [
            { sets: ['You'], value: student.length || 1 },
            { sets: ['Market'], value: market.length || 1 },
            { sets: ['Syllabus'], value: syllabus.length || 1 },
            { sets: ['You', 'Market'], value: s_m.length },
            { sets: ['You', 'Syllabus'], value: s_a.length },
            { sets: ['Market', 'Syllabus'], value: m_a.length },
            { sets: ['You', 'Market', 'Syllabus'], value: s_m_a.length }
        ];

        twinRadarChart = new Chart(ctx, {
            type: 'venn',
            data: {
                labels: ['You', 'Market', 'Syllabus'],
                datasets: [{
                    label: 'Skill Overlap',
                    data: data,
                    backgroundColor: [
                        'rgba(34, 211, 238, 0.5)',
                        'rgba(168, 85, 247, 0.5)',
                        'rgba(148, 163, 184, 0.5)'
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: true, position: 'bottom', labels: { color: '#94a3b8' } },
                    tooltip: {
                        callbacks: {
                            title: (context) => context[0].raw.sets.join(' & '),
                            label: (context) => `Overlap: ${context.raw.value} Skills`
                        }
                    }
                }
            }
        });
      }

      function renderMarketTicker() {
        const ticker = document.getElementById("market-ticker");
        if(!ticker) return;
        
        const roles = ["Gen AI Engineer", "Quantum Researcher", "Full Stack Dev", "Cybersecurity Analyst", "Blockchain Dev", "ML Ops"];
        
        // Initial Render
        updateTickerContent(ticker, roles);

        // Dynamic Update
        if (marketTickerInterval) clearInterval(marketTickerInterval);
        marketTickerInterval = setInterval(() => {
            updateTickerContent(ticker, roles);
        }, 5000);
      }

      function updateTickerContent(container, roles) {
        const getRandomTrend = () => {
            const val = Math.floor(Math.random() * 30) + 5;
            return `+${val}% Demand`;
        };

        // Fade out
        container.style.opacity = '0';
        
        setTimeout(() => {
            container.innerHTML = roles.map((r, i) => `
                <div class="flex justify-between items-center text-[10px] animate-slide-in-right" style="animation-delay: ${i * 0.1}s">
                    <span>${r}</span>
                    <span class="text-emerald-400 font-mono">${getRandomTrend()}</span>
                </div>
            `).join("");
            // Fade in
            container.style.opacity = '1';
        }, 300);
      }

      function renderMarketFeedTable(data) {
          const feedTable = document.getElementById("market-feed-table");
          if (!feedTable) return;
          feedTable.innerHTML = data.map(f => `
            <tr class="hover:bg-slate-800/30 transition">
              <td class="py-3 pl-2 font-medium text-slate-200">${f.role}</td>
              <td class="py-3 text-slate-400">${f.stack}</td>
              <td class="py-3"><span class="px-2 py-0.5 rounded bg-emerald-500/10 text-emerald-400 text-[10px] border border-emerald-500/20">${f.demand}</span></td>
              <td class="py-3 text-slate-300 font-mono">${f.salary}</td>
            </tr>
          `).join("");
      }

      async function handleMarketSearch() {
          const input = document.getElementById("market-search-input");
          const clearBtn = document.getElementById("btn-market-clear");
          const query = input.value.trim();
          if (!query) {
              renderMarketFeedTable(DEFAULT_MARKET_FEEDS);
              if (clearBtn) clearBtn.classList.add("hidden");
              return;
          }

          const lowerQ = query.toLowerCase();
          const localResults = DEFAULT_MARKET_FEEDS.filter(f => 
              f.role.toLowerCase().includes(lowerQ) || 
              f.stack.toLowerCase().includes(lowerQ)
          );

          if (clearBtn) clearBtn.classList.remove("hidden");

          if (localResults.length > 0) {
              renderMarketFeedTable(localResults);
          } else {
              // AI Search (Simulated Web Search)
              const feedTable = document.getElementById("market-feed-table");
              feedTable.innerHTML = `<tr><td colspan="4" class="text-center py-8 text-slate-400"><div class="flex flex-col items-center gap-2"><i class="fa-solid fa-circle-notch animate-spin text-cyan-400 text-xl"></i><span>Searching global market data for "${query}"...</span></div></td></tr>`;
              
              const prompt = `Using Google Search, find real-time job market data for "${query}" in India. Return ONLY a valid JSON array of 5 entries. Keys: "role", "stack", "demand" (Low/Medium/High/Very High), "salary" (e.g. "₹15 LPA"). No markdown.`;
              
              try {
                  let res = await callGemini(prompt, true);
                  res = res.replace(/```json/g, '').replace(/```/g, '').trim();
                  const aiData = JSON.parse(res);
                  if(Array.isArray(aiData)) {
                      renderMarketFeedTable(aiData);
                  } else {
                      throw new Error("Invalid Data");
                  }
              } catch(e) {
                  feedTable.innerHTML = `<tr><td colspan="4" class="text-center py-4 text-rose-400">No data found for "${query}".</td></tr>`;
              }
          }
      }

      function renderMarketInsights() {
        // Chart Logic
        const ctx = document.getElementById("market-trend-chart")?.getContext("2d");
        if (ctx) {
          if (marketTrendChart) marketTrendChart.destroy();
          
          marketTrendChart = new Chart(ctx, {
            type: 'line',
            data: {
              labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
              datasets: [
                {
                  label: 'Gen AI / LLM',
                  data: [65, 78, 90, 115, 140, 180],
                  borderColor: '#a855f7', // Purple
                  backgroundColor: 'rgba(168, 85, 247, 0.1)',
                  tension: 0.4,
                  fill: true
                },
                {
                  label: 'Quantum Computing',
                  data: [20, 22, 25, 28, 35, 45],
                  borderColor: '#22d3ee', // Cyan
                  backgroundColor: 'rgba(34, 211, 238, 0.1)',
                  tension: 0.4,
                  fill: true
                },
                {
                  label: 'Full Stack',
                  data: [80, 82, 81, 85, 86, 88],
                  borderColor: '#10b981', // Emerald
                  backgroundColor: 'rgba(16, 185, 129, 0.1)',
                  tension: 0.4,
                  fill: true
                }
              ]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: { labels: { color: '#94a3b8' } }
              },
              scales: {
                y: { grid: { color: 'rgba(148, 163, 184, 0.1)' }, ticks: { color: '#94a3b8' } },
                x: { grid: { display: false }, ticks: { color: '#94a3b8' } }
              }
            }
          });
        }

        // Top Paying Skills
        const skillsList = document.getElementById("top-paying-skills-list");
        if (skillsList) {
          const skills = [
            { name: "Rust", salary: "₹30 LPA", trend: "+12%" },
            { name: "Solidity (Web3)", salary: "₹28 LPA", trend: "+8%" },
            { name: "PyTorch (AI)", salary: "₹25 LPA", trend: "+25%" },
            { name: "Kubernetes", salary: "₹22 LPA", trend: "+10%" }
          ];
          skillsList.innerHTML = skills.map(s => `
            <div class="flex items-center justify-between p-3 rounded-lg bg-slate-900/40 border border-slate-800 hover:border-slate-700 transition">
              <div>
                <p class="text-xs font-bold text-slate-200">${s.name}</p>
                <p class="text-[10px] text-slate-500">Avg Base: ${s.salary}</p>
              </div>
              <span class="text-xs font-mono text-emerald-400 bg-emerald-500/10 px-2 py-1 rounded">${s.trend}</span>
            </div>
          `).join("");
        }

        // Live Feed
        const feedTable = document.getElementById("market-feed-table");
        if (feedTable) {
          const feeds = [
            { role: "Prompt Engineer", stack: "GPT-4, Python", demand: "Very High", salary: "₹18 LPA" },
            { role: "Quantum Algo Researcher", stack: "Qiskit, Python", demand: "High", salary: "₹35 LPA" },
            { role: "AI Ethicist", stack: "Policy, NLP", demand: "Medium", salary: "₹22 LPA" },
            { role: "DevSecOps Engineer", stack: "Docker, K8s", demand: "High", salary: "₹28 LPA" },
            { role: "Smart Contract Dev", stack: "Solidity, Hardhat", demand: "High", salary: "₹30 LPA" },
            { role: "Full Stack Developer", stack: "MERN, Next.js", demand: "Very High", salary: "₹12 LPA" },
            { role: "Data Scientist", stack: "Python, TensorFlow", demand: "High", salary: "₹18 LPA" },
            { role: "Cloud Architect", stack: "AWS, Azure", demand: "High", salary: "₹32 LPA" },
            { role: "Cybersecurity Analyst", stack: "SIEM, Python", demand: "High", salary: "₹14 LPA" },
            { role: "ML Engineer", stack: "PyTorch, Scikit", demand: "High", salary: "₹20 LPA" },
            { role: "Blockchain Developer", stack: "Rust, Solidity", demand: "Medium", salary: "₹25 LPA" },
            { role: "AR/VR Developer", stack: "Unity, C#", demand: "Medium", salary: "₹16 LPA" },
            { role: "Rust Systems Dev", stack: "Rust, C++", demand: "High", salary: "₹24 LPA" },
            { role: "Golang Backend", stack: "Go, Microservices", demand: "High", salary: "₹22 LPA" },
            { role: "K8s Administrator", stack: "Kubernetes, Helm", demand: "High", salary: "₹26 LPA" },
            { role: "NLP Specialist", stack: "HuggingFace, Spacy", demand: "High", salary: "₹21 LPA" },
            { role: "Big Data Engineer", stack: "Spark, Hadoop", demand: "Medium", salary: "₹19 LPA" }
          ];
          feedTable.innerHTML = feeds.map(f => `
            <tr class="hover:bg-slate-800/30 transition">
              <td class="py-3 pl-2 font-medium text-slate-200">${f.role}</td>
              <td class="py-3 text-slate-400">${f.stack}</td>
              <td class="py-3"><span class="px-2 py-0.5 rounded bg-emerald-500/10 text-emerald-400 text-[10px] border border-emerald-500/20">${f.demand}</span></td>
              <td class="py-3 text-slate-300 font-mono">${f.salary}</td>
            </tr>
          `).join("");
        }

        // Scarcity Insights
        renderScarcityInsights();
      }

      function calculateMarketAlignment() {
        // Calculate alignment score based on student skills vs market requirements
        const requiredSkills = ROLE_SKILLS[currentTargetRole] || [];
        const studentSkills = currentResumeSkills;
        
        if (requiredSkills.length === 0) return { score: 0, status: "bad", matches: 0 };
        
        // Count how many required skills the student has
        const matchCount = requiredSkills.filter(skill => studentSkills.includes(skill)).length;
        const alignmentPercentage = Math.round((matchCount / requiredSkills.length) * 100);
        
        // Determine status and colors
        let status = "bad";    // Red
        if (alignmentPercentage >= 75) status = "best";   // Green
        else if (alignmentPercentage >= 50) status = "good";  // Orange
        
        return {
          score: alignmentPercentage,
          status: status,
          matches: matchCount,
          total: requiredSkills.length
        };
      }

      function updateMarketAlignmentCard() {
        const alignment = calculateMarketAlignment();
        const card = document.getElementById("market-align-card");
        const icon = document.getElementById("market-align-icon");
        const text = document.getElementById("dash-market-align");
        const detail = document.getElementById("market-align-detail");
        
        if (!card || !icon || !text || !detail) return;

        // Update text
        text.textContent = alignment.status.charAt(0).toUpperCase() + alignment.status.slice(1);
        detail.textContent = `Matches ${alignment.matches}/${alignment.total} required skills`;

        // Remove old classes
        icon.className = "h-12 w-12 rounded-xl flex items-center justify-center group-hover:scale-110 transition-all";
        card.className = "glass-card rounded-xl p-5 transition-all duration-300 group animate-scale-in";
        detail.className = "text-[10px] mt-1";

        // Apply color based on status (removes old border/bg colors and applies new ones)
        if (alignment.status === "best") {
          // Green
          icon.classList.add("bg-emerald-500/10", "text-emerald-300");
          card.classList.add("border", "border-emerald-500/20", "hover:border-emerald-500/40");
          detail.classList.add("text-emerald-400");
        } else if (alignment.status === "good") {
          // Orange
          icon.classList.add("bg-amber-500/10", "text-amber-300");
          card.classList.add("border", "border-amber-500/20", "hover:border-amber-500/40");
          detail.classList.add("text-amber-400");
        } else {
          // Red (bad)
          icon.classList.add("bg-rose-500/10", "text-rose-300");
          card.classList.add("border", "border-rose-500/20", "hover:border-rose-500/40");
          detail.classList.add("text-rose-400");
        }
      }

      function renderStudentDashboard() {
        if (!currentUser || currentUser.role !== "STUDENT") return;
        
        const analysis = analyzeSkillGap(currentTargetRole);
        
        
        // Welcome with CGPA if available
        const welcomeName = document.getElementById("user-welcome-name");
        if (welcomeName) {
          let welcomeText = currentUser.fullName;
          if (currentStudentCGPA) {
            welcomeText += ` • CGPA: ${currentStudentCGPA.toFixed(2)}`;
          }
          welcomeName.textContent = welcomeText;
        }

        // Readiness
        const readinessEl = document.getElementById("dash-readiness-score");
        const readinessCircle = document.getElementById("dash-readiness-circle");
        if(readinessEl) animateValue(readinessEl, 0, analysis.readinessScore, 1000, "%");
        if(readinessCircle) {
            readinessCircle.style.setProperty('--progress', analysis.readinessScore);
        }

        // Critical Skill Gaps Count - using correct property name 'missing'
        const gapCountEl = document.getElementById("dash-gap-count");
        if(gapCountEl) gapCountEl.textContent = analysis.missing.length;

        // Target Role
        const roleEl = document.getElementById("dash-target-role");
        if(roleEl) roleEl.textContent = currentTargetRole;

        // Market Alignment
        updateMarketAlignmentCard();

        // Radar Chart
        setTimeout(() => {
            if(isVennView) {
                renderTwinVennChart();
            } else {
                renderTwinRadarChart();
            }
        }, 300);

        renderMarketTicker();
        renderFomoAlert();
      }

        

      function renderStudentProfilePage() {
        if (!currentUser) return;

        const nameEl = document.getElementById("profile-view-name");
        if (nameEl) nameEl.textContent = currentUser.fullName;

        const usernameEl = document.getElementById("profile-view-username");
        if (usernameEl) usernameEl.textContent = currentUser.username;

        const emailEl = document.getElementById("profile-view-email");
        if (emailEl) emailEl.textContent = currentUser.email;

        // CGPA Display
        const cgpaEl = document.getElementById("profile-view-cgpa");
        const cgpaStatusEl = document.getElementById("profile-view-cgpa-status");
        const cgpaBar = document.getElementById("profile-cgpa-bar");
        
        if (currentStudentCGPA) {
          const percentage = (currentStudentCGPA / 10) * 100;
          cgpaEl.textContent = currentStudentCGPA.toFixed(2);
          cgpaBar.style.width = percentage + "%";
          
          if (currentStudentCGPA >= 8.5) {
            cgpaEl.className = "text-2xl font-bold text-emerald-400";
            cgpaStatusEl.textContent = "Excellent";
            cgpaStatusEl.className = "text-[10px] text-emerald-400";
            cgpaBar.className = "h-full bg-emerald-500 transition-all duration-300";
          } else if (currentStudentCGPA >= 7.5) {
            cgpaEl.className = "text-2xl font-bold text-cyan-400";
            cgpaStatusEl.textContent = "Very Good";
            cgpaStatusEl.className = "text-[10px] text-cyan-400";
            cgpaBar.className = "h-full bg-cyan-500 transition-all duration-300";
          } else if (currentStudentCGPA >= 6.5) {
            cgpaEl.className = "text-2xl font-bold text-blue-400";
            cgpaStatusEl.textContent = "Good";
            cgpaStatusEl.className = "text-[10px] text-blue-400";
            cgpaBar.className = "h-full bg-blue-500 transition-all duration-300";
          } else if (currentStudentCGPA >= 5.0) {
            cgpaEl.className = "text-2xl font-bold text-amber-400";
            cgpaStatusEl.textContent = "Average";
            cgpaStatusEl.className = "text-[10px] text-amber-400";
            cgpaBar.className = "h-full bg-amber-500 transition-all duration-300";
          } else {
            cgpaEl.className = "text-2xl font-bold text-rose-400";
            cgpaStatusEl.textContent = "Below Average";
            cgpaStatusEl.className = "text-[10px] text-rose-400";
            cgpaBar.className = "h-full bg-rose-500 transition-all duration-300";
          }
        } else {
          cgpaEl.textContent = "—";
          cgpaStatusEl.textContent = "Not entered";
          cgpaBar.style.width = "0%";
        }

        const resumeSkillsContainer = document.getElementById("profile-resume-skills");
        if (resumeSkillsContainer) {
            resumeSkillsContainer.innerHTML = currentResumeSkills.length > 0
                ? currentResumeSkills.map(s => `<span class="px-2 py-1 rounded bg-cyan-500/10 text-cyan-300 text-xs border border-cyan-500/30">${s}</span>`).join("")
                : '<p class="text-xs text-slate-400">No skills extracted from portfolio yet. Go to the Analyzer.</p>';
        }

        const syllabusSkillsContainer = document.getElementById("profile-syllabus-skills");
        if (syllabusSkillsContainer) {
            syllabusSkillsContainer.innerHTML = currentSyllabusSkills.length > 0
                ? currentSyllabusSkills.map(s => `<span class="px-2 py-1 rounded bg-purple-500/10 text-purple-300 text-xs border border-purple-500/30">${s}</span>`).join("")
                : '<p class="text-xs text-slate-400">No skills extracted from syllabus yet. Go to the Analyzer.</p>';
        }
      }

      function renderSimulator() {
        const roleSelector = document.getElementById("role-selector");
        if(roleSelector) {
            roleSelector.value = currentTargetRole;
            roleSelector.onchange = (e) => {
                currentTargetRole = e.target.value;
                renderSimulator(); // Re-render
            };
        }

        const analysis = analyzeSkillGap(currentTargetRole);

        const reqContainer = document.getElementById("sim-req-skills");
        if(reqContainer) {
            reqContainer.innerHTML = analysis.required.map(s => 
                `<span class="px-2 py-1 rounded bg-slate-800 text-slate-300 text-xs border border-slate-700">${s}</span>`
            ).join("");
        }

        const missingContainer = document.getElementById("sim-missing-skills");
        if(missingContainer) {
            missingContainer.innerHTML = analysis.missing.length > 0 
                ? analysis.missing.map(s => `<span class="px-2 py-1 rounded bg-rose-500/10 text-rose-300 text-xs border border-rose-500/30">${s}</span>`).join("")
                : '<span class="text-emerald-400 text-xs">You are ready for this role!</span>';
        }

        const timeEl = document.getElementById("sim-time");
        if(timeEl) timeEl.textContent = (analysis.missing.length * 2) + " Weeks";

        const effortEl = document.getElementById("sim-effort");
        if(effortEl) {
            const effort = analysis.missing.length > 4 ? "High" : analysis.missing.length > 2 ? "Medium" : "Low";
            effortEl.textContent = effort;
            effortEl.className = `text-2xl font-bold ${effort === "High" ? "text-rose-400" : effort === "Medium" ? "text-amber-400" : "text-emerald-400"}`;
        }
      }

      function generateRoadmapUI() {
        const analysis = analyzeSkillGap(currentTargetRole);
        const container = document.getElementById("roadmap-container");
        if(!container) return;

        if(analysis.missing.length === 0) {
            container.innerHTML = '<p class="text-emerald-400">No gaps found! You are ready.</p>';
            return;
        }

        container.innerHTML = analysis.missing.map((skill, idx) => {
            const ytLink = `https://www.youtube.com/results?search_query=${encodeURIComponent(skill + " full course tutorial")}`;
            const projectLink = `https://github.com/search?q=${encodeURIComponent(skill + " beginner project")}&type=repositories`;
            return `
            <div class="relative animate-slide-in-right" style="animation-delay: ${idx * 0.2}s">
                <div class="absolute -left-[41px] top-0 h-6 w-6 rounded-full bg-slate-900 border-2 border-cyan-500 flex items-center justify-center z-10">
                    <span class="text-[10px] text-cyan-400 font-bold">${idx + 1}</span>
                </div>
                <div class="glass-card p-4 rounded-xl border border-slate-700/50">
                    <h4 class="text-sm font-bold text-slate-100">Week ${idx + 1}: Master ${skill}</h4>
                    <p class="text-xs text-slate-400 mt-1">Focus on core concepts and build a mini-project.</p>
                    <div class="mt-3 flex gap-2">
                        <a href="${ytLink}" target="_blank" class="px-3 py-1 bg-cyan-500/10 text-cyan-300 text-[10px] rounded border border-cyan-500/30 hover:bg-cyan-500/20 flex items-center gap-2">
                            <i class="fa-brands fa-youtube"></i> Watch Tutorial
                        </a>
                        <a href="${projectLink}" target="_blank" class="px-3 py-1 bg-purple-500/10 text-purple-300 text-[10px] rounded border border-purple-500/30 hover:bg-purple-500/20 flex items-center gap-2">
                            <i class="fa-brands fa-github"></i> Practice Project
                        </a>
                    </div>
                </div>
            </div>
        `}).join("");

        // Initialize Tilt on new roadmap cards
        if (typeof VanillaTilt !== "undefined") {
            VanillaTilt.init(container.querySelectorAll(".glass-card"), {
                max: 5,
                speed: 400,
                glare: true,
                "max-glare": 0.2,
                scale: 1.02
            });
        }

        const recContainer = document.getElementById("course-recommendations");
        if(recContainer) {
            const courseraLink = `https://www.coursera.org/search?query=${encodeURIComponent(currentTargetRole + " Specialization")}`;
            const udemyLink = `https://www.udemy.com/courses/search/?q=${encodeURIComponent("Complete " + (analysis.missing[0] || "Skill") + " Bootcamp")}`;

            recContainer.innerHTML = `
                <a href="${courseraLink}" target="_blank" class="block p-3 rounded-lg bg-slate-900/50 border border-slate-800 hover:border-cyan-500/30 transition cursor-pointer group">
                    <div class="flex items-center justify-between">
                        <p class="text-xs font-bold text-slate-200 group-hover:text-cyan-400 transition">Coursera: ${currentTargetRole} Specialization</p>
                        <i class="fa-solid fa-arrow-up-right-from-square text-[10px] text-slate-500 group-hover:text-cyan-400"></i>
                    </div>
                    <p class="text-[10px] text-slate-500 mt-1">Rated 4.8/5 • 3 Months</p>
                </a>
                <a href="${udemyLink}" target="_blank" class="block p-3 rounded-lg bg-slate-900/50 border border-slate-800 hover:border-purple-500/30 transition cursor-pointer group">
                    <div class="flex items-center justify-between">
                        <p class="text-xs font-bold text-slate-200 group-hover:text-purple-400 transition">Udemy: Complete ${analysis.missing[0] || "Skill"} Bootcamp</p>
                        <i class="fa-solid fa-arrow-up-right-from-square text-[10px] text-slate-500 group-hover:text-purple-400"></i>
                    </div>
                    <p class="text-[10px] text-slate-500 mt-1">Rated 4.7/5 • 20 Hours</p>
                </a>
            `;
        }
      }

      function renderFomoAlert() {
        const alertEl = document.getElementById("fomo-alert");
        const msgEl = document.getElementById("fomo-message");
        if (!alertEl || !msgEl) return;

        // Find best opportunity and worst saturation for contrast
        const opp = SCARCITY_DATA.find(d => d.type === "opportunity");
        const sat = SCARCITY_DATA.find(d => d.type === "saturated");

        if (opp && sat) {
            msgEl.innerHTML = `
                <span class="text-rose-300 font-semibold">${sat.supply} students</span> in your area are learning ${sat.skill}. 
                Only <span class="text-emerald-300 font-semibold">${opp.supply}</span> are learning <span class="text-slate-100 font-bold border-b border-amber-500/50">${opp.skill}</span>. 
                There are <span class="text-amber-300 font-bold">${opp.demand} open jobs</span> for it right now.
            `;
            alertEl.classList.remove("hidden");
            
            // Click to go to market insights
            alertEl.onclick = () => {
                switchView("market-insights");
                renderMarketInsights();
            };
        }
      }

      function renderScarcityInsights() {
        const satList = document.getElementById("saturated-list");
        const oppList = document.getElementById("opportunity-list");
        if (!satList || !oppList) return;

        const renderItem = (item, isOpp) => `
            <div class="p-3 rounded-lg bg-slate-900/40 border ${isOpp ? 'border-emerald-500/20 hover:border-emerald-500/40' : 'border-rose-500/20 hover:border-rose-500/40'} transition flex items-center justify-between group">
                <div>
                    <p class="text-xs font-bold text-slate-200 group-hover:text-white transition">${item.skill}</p>
                    <p class="text-[10px] text-slate-500">Supply: ${item.supply} • Demand: ${item.demand}</p>
                </div>
                <div class="text-right">
                    <p class="text-xs font-mono ${isOpp ? 'text-emerald-400' : 'text-rose-400'}">${item.salary}</p>
                    <p class="text-[10px] text-slate-500">Ratio: ${(item.demand/item.supply).toFixed(1)}x</p>
                </div>
            </div>
        `;

        satList.innerHTML = SCARCITY_DATA.filter(d => d.type === "saturated").map(d => renderItem(d, false)).join("");
        oppList.innerHTML = SCARCITY_DATA.filter(d => d.type === "opportunity").map(d => renderItem(d, true)).join("");
      }

      /**********************
       * Notifications
       **********************/

      function renderNotificationsList(elementId, limit = null) {
        const container = document.getElementById(elementId);
        if (!container) return;
        container.innerHTML = "";

        if (!db.notifications.length) {
          container.innerHTML =
            '<p class="text-sm text-slate-400 text-center py-4">No announcements yet.</p>';
          return;
        }
        const sorted = [...db.notifications].sort(
          (a, b) => new Date(b.date) - new Date(a.date)
        );
        const toShow = limit ? sorted.slice(0, limit) : sorted;

        toShow.forEach((n) => {
          const div = document.createElement("div");
          div.className =
            "rounded-lg bg-slate-900/60 border border-slate-800 px-4 py-3 flex flex-col gap-2 hover:border-emerald-500/30 transition";
          div.innerHTML = `
            <div class="flex items-center justify-between gap-2">
              <p class="text-sm font-semibold text-slate-100">${n.title}</p>
              <span class="text-xs text-slate-400 font-mono">${n.date}</span>
            </div>
            <p class="text-xs text-slate-300 leading-relaxed">${n.msg}</p>
            <p class="text-xs text-slate-500 italic">— ${n.author}</p>
          `;
          container.appendChild(div);
        });
      }

      function renderNotificationsStandalone() {
        renderNotificationsList("notifications-view-list");
      }

      /**********************
       * Authentication
       **********************/

      function attemptLogin(username, password) {
        const user = db.users.find(
          (u) => u.username.toLowerCase() === username.toLowerCase() && u.password === password
        );
        if (!user) return null;
        return user;
      }

      function handleLogin(event) {
        event.preventDefault();
        const username = document.getElementById("username").value.trim();
        const password = document.getElementById("password").value.trim();
        const spinner = document.getElementById("login-spinner");

        spinner.classList.remove("hidden");

        setTimeout(() => {
          const user = attemptLogin(username, password);
          spinner.classList.add("hidden");

          if (!user) {
            showToast("Invalid credentials. Please check your username or password.", "error");
            return;
          }

          currentUser = user;
          sessionStorage.setItem(
            SESSION_KEY,
            JSON.stringify({ id: user.id, username: user.username })
          );

          showToast("Signed in successfully.", "success");
          onAuthenticated();
        }, 500);
      }

      function restoreSession() {
        try {
          const raw = sessionStorage.getItem(SESSION_KEY);
          if (!raw) return;
          const parsed = JSON.parse(raw);
          if (!parsed || typeof parsed.id !== "number") return;
          const user = db.users.find((u) => u.id === parsed.id);
          if (user) {
            currentUser = user;
            onAuthenticated(true);
          }
        } catch (e) {
          console.warn("Failed to restore session.", e);
        }
      }

      function logout() {
        currentUser = null;
        sessionStorage.removeItem(SESSION_KEY);
        // Ensure chat is closed
        document.getElementById("ai-chat-widget").classList.add("hidden");
        document.getElementById("ai-chat-window").classList.add("hidden");
        aiChatOpen = false;
        window.scrollTo(0, 0);
        showLogin();
      }

      function onAuthenticated(isRestored = false) {
        if (!currentUser) return;
        showAppShell();
        updateSidebarForUser();

        if (currentUser.role === "STUDENT") {
          renderStudentDashboard();
          switchView("dashboard");
        } else {
          logout(); // Should not happen with simplified DB
        }

        if (!isRestored) {
          document.getElementById("username").value = "";
          document.getElementById("password").value = "";
        }
        // Remove login overlay from DOM so it no longer interferes with the app
        const loginView = document.getElementById("login-view");
        if (loginView) {
          // hide first for a smooth transition, then remove
          loginView.classList.add("hidden");
          setTimeout(() => {
            if (loginView.parentNode) loginView.parentNode.removeChild(loginView);
          }, 300);
        }
      }

      /**********************
       * File Processing & Skill Extraction
       **********************/

      async function extractTextFromPDF(file) {
        if (!file) return "";
        try {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
            let fullText = "";
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const textContent = await page.getTextContent();
                const pageText = textContent.items.map(item => item.str).join(" ");
                fullText += pageText + "\n";
            }
            return fullText;
        } catch (e) {
            console.error("PDF Extraction Error", e);
            return "";
        }
      }

      function extractSkillsFromText(text) {
        const found = new Set();
        const lowerText = text.toLowerCase();
        SKILL_DB.forEach(skill => {
            // Simple inclusion check, can be improved with regex boundary
            const regex = new RegExp(`\\b${skill.toLowerCase().replace(/[.*+?^${}()|[\]\\]/g, '\\$&')}\\b`, 'i');
            if (regex.test(lowerText)) {
                found.add(skill);
            }
        });
        return Array.from(found);
      }

      /**********************
       * Event Wiring
       **********************/

      function setupEventListeners() {
        document
          .getElementById("login-form")
          .addEventListener("submit", handleLogin);

        document
          .getElementById("logout-btn")
          .addEventListener("click", () => logout());

        // Sidebar toggle for mobile
        const sidebarToggle = document.getElementById("sidebar-toggle");
        const sidebar = document.getElementById("sidebar");
        sidebarToggle.addEventListener("click", () => {
          sidebar.classList.toggle("hidden");
        });

        // Global Analyze Button
        const analyzeBtn = document.getElementById("btn-global-analyze");
        if(analyzeBtn) analyzeBtn.addEventListener("click", async () => {
          if (!currentUser) return;

          if (currentUser.role === "STUDENT") {
            const analysis = analyzeSkillGap(currentTargetRole);
            const outputEl = document.getElementById("dashboard-ai-output");

            // Generate local insights without calling broken Gemini API
            let insights = `<h3 class='text-sm font-bold text-emerald-300 mb-2'>Career Roadmap for ${currentTargetRole}</h3>`;
            
            if (analysis.missing.length === 0) {
              insights += `<p>✅ Great! You have all required skills for <strong>${currentTargetRole}</strong>. Your readiness is <strong>${analysis.readinessScore}%</strong>.</p>
                <p class='mt-2'>Next steps: <strong>1)</strong> Build 2-3 portfolio projects using your skills. <strong>2)</strong> Start applying to roles. <strong>3)</strong> Consider specialization (ML, DevOps, etc.)</p>`;
            } else {
              const top3Missing = analysis.missing.slice(0, 3);
              insights += `<p><strong>Current Readiness:</strong> ${analysis.readinessScore}%</p>
                <p class='mt-2'><strong>Action Plan (3 Steps):</strong></p>
                <ol class='ml-4 mt-1'>
                  <li><strong>Learn Priority Skills (${top3Missing.slice(0, 1).join(", ")}):</strong> Dedicate 4 weeks with online courses + daily practice.</li>
                  <li><strong>Build Projects:</strong> Create 2 end-to-end projects using new + existing skills.</li>
                  <li><strong>Apply:</strong> Target 5-10 job postings matching your skill profile.</li>
                </ol>`;
              insights += `<p class='mt-2'><strong>Top Skills to Master:</strong> ${top3Missing.join(", ")}</p>`;
            }
            
            outputEl.innerHTML = insights;
            
            // Also trigger roadmap generation
            generateRoadmapUI();
            switchView('roadmap');
          }
        });

        // Resume/Syllabus Process Buttons
        const btnProcessResume = document.getElementById("btn-process-resume");
        if(btnProcessResume) btnProcessResume.addEventListener("click", async () => {
            const fileInput = document.getElementById("file-resume");
            const urlInput = document.getElementById("input-resume-url");
            let text = document.getElementById("input-resume-text").value;
            
            if (fileInput && fileInput.files.length > 0) {
                showToast("Reading PDF...", "info");
                const pdfText = await extractTextFromPDF(fileInput.files[0]);
                text += "\n" + pdfText;
            }

            if (urlInput && urlInput.value.trim()) {
              const url = urlInput.value.trim();
              // If it's a GitHub URL, try repo fetch first, then profile, else fall back to AI
              const repoMatch = url.match(/^https?:\/\/(?:www\.)?github\.com\/([^\/\s]+)\/([^\/\s]+)(?:\.git)?\/?$/i);
              const profileMatch = url.match(/^https?:\/\/(?:www\.)?github\.com\/([^\/\s]+)\/?$/i);
              if (repoMatch) {
                showToast("Fetching GitHub repository data...", "info");
                try {
                  const repoSummary = await fetchGitHubRepo(url);
                  text += "\n" + repoSummary;
                  showToast("GitHub repository data extracted.", "success");
                } catch (ghErr) {
                  console.warn('GitHub repo fetch failed, falling back to AI', ghErr);
                  showToast("GitHub fetch failed; falling back to AI analysis...", "info");
                  try {
                    const prompt = `Analyze the public developer profile at ${url}. Extract a list of technical skills, programming languages, frameworks, and tools mentioned or used in repositories. Return ONLY a comma-separated list of skills.`;
                    const aiData = await callGemini(prompt, true);
                    text += "\n" + aiData;
                    showToast("Profile data extracted successfully.", "success");
                  } catch (e) {
                    console.error("Profile analysis failed", e);
                    showToast("Could not analyze URL. Try pasting text.", "error");
                  }
                }
              } else if (profileMatch) {
                showToast("Fetching GitHub profile...", "info");
                try {
                  const ghSummary = await fetchGitHubProfile(url);
                  text += "\n" + ghSummary;
                  showToast("GitHub profile data extracted.", "success");
                } catch (ghErr) {
                  console.warn('GitHub fetch failed, falling back to AI', ghErr);
                  showToast("GitHub fetch failed; falling back to AI analysis...", "info");
                  try {
                    const prompt = `Analyze the public developer profile at ${url}. Extract a list of technical skills, programming languages, frameworks, and tools mentioned or used in repositories. Return ONLY a comma-separated list of skills.`;
                    const aiData = await callGemini(prompt, true);
                    text += "\n" + aiData;
                    showToast("Profile data extracted successfully.", "success");
                  } catch (e) {
                    console.error("Profile analysis failed", e);
                    showToast("Could not analyze URL. Try pasting text.", "error");
                  }
                }
              } else if (url.match(/linkedin\.com/i)) {
                // LinkedIn requires manual copy-paste due to privacy policies
                showToast("LinkedIn profiles require manual copy-paste. Please copy your profile details and paste them in the text area.", "info");
              } else {
                // Other URLs: skip AI (which is currently unavailable) and suggest manual copy-paste
                showToast("For non-GitHub profiles, please manually copy your profile details or paste them in the text area above.", "info");
              }
            }

            document.getElementById("input-resume-text").value = text; // Update textarea

            // Capture CGPA if entered
            const cgpaInputVal = document.getElementById("input-student-cgpa").value;
            if (cgpaInputVal) {
              currentStudentCGPA = parseFloat(cgpaInputVal);
            }

            if(text.trim()) {
                const skills = extractSkillsFromText(text);
                if (skills.length > 0) {
                    currentResumeSkills = skills;
                    let message = `Portfolio processed! Extracted ${skills.length} skills: ${skills.slice(0, 3).join(", ")}...`;
                    if (currentStudentCGPA) {
                      message += ` | CGPA: ${currentStudentCGPA.toFixed(2)}`;
                    }
                    showToast(message, "success");
                } else {
                    showToast("No known skills found. Try adding keywords manually.", "info");
                }
            } else {
                showToast("Please upload a PDF, enter a URL, or paste text.", "error");
            }
        });

        const btnProcessSyllabus = document.getElementById("btn-process-syllabus");
        if(btnProcessSyllabus) btnProcessSyllabus.addEventListener("click", async () => {
            const fileInput = document.getElementById("file-syllabus");
            const urlInput = document.getElementById("input-syllabus-url");
            let text = document.getElementById("input-syllabus-text").value;

            if (fileInput && fileInput.files.length > 0) {
                showToast("Reading PDF...", "info");
                const pdfText = await extractTextFromPDF(fileInput.files[0]);
                text += "\n" + pdfText;
            }

            if (urlInput && urlInput.value.trim()) {
                const url = urlInput.value.trim();
                showToast("Analyzing syllabus URL via AI...", "info");
                try {
                    const prompt = `Analyze the academic syllabus or course curriculum at ${url}. Extract a list of technical topics, subjects, and skills covered. Return ONLY a comma-separated list of skills/topics.`;
                    const aiData = await callGemini(prompt, true);
                    text += "\n" + aiData;
                    showToast("Syllabus data extracted successfully.", "success");
                } catch (e) {
                    console.error("Syllabus analysis failed", e);
                    showToast("Could not analyze URL. Try pasting text.", "error");
                }
            }

            document.getElementById("input-syllabus-text").value = text;

            if(text.trim()) {
                const skills = extractSkillsFromText(text);
                if (skills.length > 0) {
                    currentSyllabusSkills = skills;
                    showToast(`Syllabus processed! Found ${skills.length} relevant skills.`, "success");
                } else {
                    showToast("No relevant skills found in syllabus.", "info");
                }
            } else {
                showToast("Please upload a PDF, enter a URL, or paste text.", "error");
            }
        });

        const btnRunAnalysis = document.getElementById("btn-run-analysis");
        if(btnRunAnalysis) btnRunAnalysis.addEventListener("click", () => {
            switchView('dashboard');
            renderStudentDashboard();
            showToast("Twin Engine Analysis Complete", "success");
        });

        // Notifications standalone view navigation
        document
          .getElementById("view-notifications-btn")
          .addEventListener("click", () => {
            renderNotificationsStandalone();
            switchView("notifications-view");
          });

        document
          .getElementById("btn-back-from-notifications")
          .addEventListener("click", () => {
            if (!currentUser) return;
            if (currentUser.role === "STUDENT") switchView("dashboard");
          });

        // Theme toggle
        document.getElementById("theme-toggle").addEventListener("click", toggleTheme);

        // CGPA Input Listener - Dynamic progress and status
        const cgpaInput = document.getElementById("input-student-cgpa");
        if (cgpaInput) {
          cgpaInput.addEventListener("input", (e) => {
            const cgpaValue = parseFloat(e.target.value);
            const progressBar = document.getElementById("cgpa-progress-bar");
            const statusMsg = document.getElementById("cgpa-status");
            const cgpaDisplay = document.getElementById("cgpa-display");

            if (isNaN(cgpaValue) || cgpaValue === "") {
              progressBar.style.width = "0%";
              progressBar.className = "h-full bg-slate-600 transition-all duration-300";
              statusMsg.textContent = "Enter CGPA to see assessment";
              statusMsg.className = "text-[10px] text-slate-500";
              cgpaDisplay.textContent = "—";
              currentStudentCGPA = null;
            } else if (cgpaValue < 0 || cgpaValue > 10) {
              statusMsg.textContent = "CGPA must be between 0 and 10";
              statusMsg.className = "text-[10px] text-rose-400";
              cgpaDisplay.className = "text-sm font-semibold text-rose-400 w-12 text-right";
            } else {
              currentStudentCGPA = cgpaValue;
              const percentage = (cgpaValue / 10) * 100;
              progressBar.style.width = percentage + "%";
              cgpaDisplay.textContent = cgpaValue.toFixed(2);

              if (cgpaValue >= 8.5) {
                progressBar.className = "h-full bg-emerald-500 transition-all duration-300";
                statusMsg.textContent = "Excellent! Outstanding academic performance.";
                statusMsg.className = "text-[10px] text-emerald-400";
                cgpaDisplay.className = "text-sm font-semibold text-emerald-400 w-12 text-right";
              } else if (cgpaValue >= 7.5) {
                progressBar.className = "h-full bg-cyan-500 transition-all duration-300";
                statusMsg.textContent = "Very Good! Strong academic foundation.";
                statusMsg.className = "text-[10px] text-cyan-400";
                cgpaDisplay.className = "text-sm font-semibold text-cyan-400 w-12 text-right";
              } else if (cgpaValue >= 6.5) {
                progressBar.className = "h-full bg-blue-500 transition-all duration-300";
                statusMsg.textContent = "Good! Solid academic performance.";
                statusMsg.className = "text-[10px] text-blue-400";
                cgpaDisplay.className = "text-sm font-semibold text-blue-400 w-12 text-right";
              } else if (cgpaValue >= 5.0) {
                progressBar.className = "h-full bg-amber-500 transition-all duration-300";
                statusMsg.textContent = "Average. Room for improvement in academics.";
                statusMsg.className = "text-[10px] text-amber-400";
                cgpaDisplay.className = "text-sm font-semibold text-amber-400 w-12 text-right";
              } else {
                progressBar.className = "h-full bg-rose-500 transition-all duration-300";
                statusMsg.textContent = "Below Average. Focus on studies to improve.";
                statusMsg.className = "text-[10px] text-rose-400";
                cgpaDisplay.className = "text-sm font-semibold text-rose-400 w-12 text-right";
              }
            }
          });
        }

        // AI Chat
        document.getElementById("ai-chat-toggle").addEventListener("click", toggleAIChat);
        document.getElementById("ai-chat-button").addEventListener("click", toggleAIChat);
        document.getElementById("ai-chat-close").addEventListener("click", () => {
          document.getElementById("ai-chat-window").classList.add("hidden");
          aiChatOpen = false;
        });
        document.getElementById("ai-chat-send").addEventListener("click", () => {
          const input = document.getElementById("ai-chat-input");
          if (input.value.trim()) {
            sendAIMessage(input.value.trim());
            input.value = "";
          }
        });
        document.getElementById("ai-chat-input").addEventListener("keypress", (e) => {
          if (e.key === "Enter" && e.target.value.trim()) {
            sendAIMessage(e.target.value.trim());
            e.target.value = "";
          }
        });

        // Export buttons
        const exportBtn = document.getElementById("btn-export-report");
        if (exportBtn) {
          exportBtn.addEventListener("click", () => {
            // Placeholder for a new, relevant export function
            showToast("Exporting Skill Profile...", "info");
          });
        }

        // Keyboard shortcuts
        setupKeyboardShortcuts();

        // Card navigation handlers
        document.querySelectorAll('[data-nav-card]').forEach(card => {
          card.addEventListener('click', () => {
            const viewId = card.getAttribute('data-nav-card');
            switchView(viewId);
          });
        });

        // Market Pulse Button
        document.getElementById("market-pulse-btn").addEventListener("click", () => {
          switchView("market-insights");
          renderMarketInsights();
        });

        // Market Search
        document.getElementById("btn-market-search").addEventListener("click", handleMarketSearch);
        document.getElementById("market-search-input").addEventListener("keypress", (e) => {
            if (e.key === "Enter") {
                handleMarketSearch();
            }
        });
        
        // Market Clear
        document.getElementById("btn-market-clear").addEventListener("click", () => {
            const input = document.getElementById("market-search-input");
            const clearBtn = document.getElementById("btn-market-clear");
            if (input) input.value = "";
            if (clearBtn) clearBtn.classList.add("hidden");
            renderMarketFeedTable(DEFAULT_MARKET_FEEDS);
        });

        // Chart Toggle
        const btnToggleChart = document.getElementById("btn-toggle-chart");
        if(btnToggleChart) btnToggleChart.addEventListener("click", () => {
            isVennView = !isVennView;
            const btnText = document.getElementById("chart-toggle-text");
            if(isVennView) {
                btnText.textContent = "View Radar";
                renderTwinVennChart();
            } else {
                btnText.textContent = "View Venn";
                renderTwinRadarChart();
            }
        });
      }

      function initTilt() {
        // Apply 3D Tilt to main content cards
        if (typeof VanillaTilt !== "undefined") {
            VanillaTilt.init(document.querySelectorAll("main .glass-card"), {
                max: 5,
                speed: 400,
                glare: true,
                "max-glare": 0.2,
                scale: 1.02
            });
        }
      }

      /**********************
       * Bootstrap
       **********************/

      document.addEventListener("DOMContentLoaded", () => {
        setupEventListeners();
        initTheme();
        // Always show the login page on initial load.
        // The restoreSession() function is commented out to enforce this.
        showLogin();
        updateNotificationBadge();
        initTilt();
      });
    </script>
  </body>
</html>
